commented;modifiers;parameterAmount;loc;comment;code
true;protected;0;9;/**  * Set up the Broker  *  * @see CamelTestSupport#doPreSetup()  *  * @throws Exception  */ ;/**  * Set up the Broker  *  * @see CamelTestSupport#doPreSetup()  *  * @throws Exception  */ @Override protected void doPreSetup() throws Exception {     broker = new EmbeddedJMS().     deleteDirectory("target/data").     port = AvailablePortFinder.getNextAvailable(33333).     brokerUri = "tcp://localhost:" + port.     configureBroker(this.broker).     startBroker(). }
false;protected;1;23;;protected void configureBroker(EmbeddedJMS broker) throws Exception {     Configuration configuration = new ConfigurationImpl().setPersistenceEnabled(false).setJournalDirectory("target/data/journal").setSecurityEnabled(false).addAcceptorConfiguration("connector", brokerUri + "?protocols=CORE,AMQP").addAcceptorConfiguration("vm", "vm://123").addConnectorConfiguration("connector", new TransportConfiguration(NettyConnectorFactory.class.getName())).     JMSConfiguration jmsConfig = new JMSConfigurationImpl().     ConnectionFactoryConfiguration cfConfig = new ConnectionFactoryConfigurationImpl().setName("cf").setConnectorNames(Arrays.asList("connector")).setBindings("cf").     jmsConfig.getConnectionFactoryConfigurations().add(cfConfig).     JMSQueueConfiguration queueConfig = new JMSQueueConfigurationImpl().setName("queue1").setDurable(false).setBindings("queue/queue1").     jmsConfig.getQueueConfigurations().add(queueConfig).     JMSQueueConfiguration topicConfig = new JMSQueueConfigurationImpl().setName("foo").setDurable(true).setBindings("topic/foo").     jmsConfig.getQueueConfigurations().add(topicConfig).     broker.setConfiguration(configuration).setJmsConfiguration(jmsConfig). }
false;private;0;4;;private void startBroker() throws Exception {     broker.start().     log.info("Started Embedded JMS Server"). }
false;public;0;23;;@Override public void tearDown() throws Exception {     super.tearDown().     DefaultCamelContext dcc = (DefaultCamelContext) context.     while (!dcc.isStopped()) {         log.info("Waiting on the Camel Context to stop").     }     log.info("Closing JMS Session").     if (getSession() != null) {         getSession().close().         setSession(null).     }     log.info("Closing JMS Connection").     if (connection != null) {         connection.stop().         connection = null.     }     log.info("Stopping the ActiveMQ Broker").     if (broker != null) {         broker.stop().         broker = null.     } }
false;protected;0;13;;@Override protected CamelContext createCamelContext() throws Exception {     CamelContext camelContext = super.createCamelContext().     ConnectionFactory connectionFactory = getConnectionFactory().     connection = connectionFactory.createConnection().     connection.start().     session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE).     JmsComponent component = new JmsComponent().     component.setConnectionFactory(connectionFactory).     component.setClientId(getClientId()).     camelContext.addComponent("jms", component).     return camelContext. }
false;protected;0;3;;protected String getClientId() {     return null. }
false;protected;0;3;;protected ConnectionFactory getConnectionFactory() throws Exception {     return ActiveMQJMSClient.createConnectionFactory(brokerUri, "test"). }
false;public;1;3;;public QueueQueryResult getQueueQueryResult(String queueQuery) throws Exception {     return broker.getActiveMQServer().queueQuery(new SimpleString(queueQuery)). }
false;public;1;3;;public void setSession(Session session) {     this.session = session. }
false;public;0;3;;public Session getSession() {     return session. }
false;public;1;4;;public MessageConsumer createQueueConsumer(String destination) throws Exception {     Queue queue = session.createQueue(destination).     return session.createConsumer(queue). }
false;public;2;4;;public MessageConsumer createTopicConsumer(String destination, String messageSelector) throws Exception {     Topic topic = session.createTopic(destination).     return session.createConsumer(topic, messageSelector). }
