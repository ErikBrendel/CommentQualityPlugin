commented;modifiers;parameterAmount;loc;comment;code
false;public;0;42;;@Test public void test() throws Exception {     JChannel chA = new JChannel("raftABC.xml").name("A").     RaftHandle handleA = new RaftHandle(chA, new NopStateMachine()).raftId("A").     CamelContext contextA = createContext("A", handleA).     JChannel chB = new JChannel("raftABC.xml").name("B").     RaftHandle handleB = new RaftHandle(chB, new NopStateMachine()).raftId("B").     CamelContext contextB = createContext("B", handleB).     JChannel chC = new JChannel("raftABC.xml").name("C").     RaftHandle handleC = new RaftHandle(chC, new NopStateMachine()).raftId("C").     CamelContext contextC = createContext("C", handleC).     lcc.add(contextA).     rn.add("route-A").     lcc.add(contextB).     rn.add("route-B").     lcc.add(contextC).     rn.add("route-C").     contextA.start().     contextB.start().     contextC.start().     waitForLeader(50, handleA, handleB, handleC).     assertEquals(1, countActiveFromEndpoints(lcc, rn)).     contextA.stop().     waitForLeader(50, handleA, handleB, handleC).     assertEquals(1, countActiveFromEndpoints(lcc, rn)).     contextB.stop().     JGroupsRaftClusterService service = new JGroupsRaftClusterService().     service.setId("A").     service.setRaftId("A").     service.setRaftHandle(handleA).     service.setJgroupsClusterName("JGroupsRaftMasterTest").     contextA.addService(service).     contextA.start().     waitForLeader(50, handleA, handleB, handleC).     assertEquals(1, countActiveFromEndpoints(lcc, rn)). }
false;public;0;6;;@Override public void configure() throws Exception {     from("master:jgr:timer:master?delay=1s&period=1s").routeId("route-" + id).log("From ${routeId}"). }
false;private;2;22;;private CamelContext createContext(String id, RaftHandle rh) throws Exception {     JGroupsRaftClusterService service = new JGroupsRaftClusterService().     service.setId(id).     service.setRaftId(id).     service.setRaftHandle(rh).     service.setJgroupsClusterName("JGroupsRaftMasterTest").     DefaultCamelContext context = new DefaultCamelContext().     context.disableJMX().     context.setName("context-" + id).     context.addService(service).     context.addRoutes(new RouteBuilder() {          @Override         public void configure() throws Exception {             from("master:jgr:timer:master?delay=1s&period=1s").routeId("route-" + id).log("From ${routeId}").         }     }).     return context. }
false;private;2;18;;private int countActiveFromEndpoints(ArrayList<CamelContext> lcc, ArrayList<String> rn) throws NoSuchFieldException, IllegalAccessException {     int result = 0.     if (lcc.size() != rn.size()) {         throw new UnsupportedOperationException("CamelContext list and Route ids list must have the same number of elements!").     }     for (int i = 0. i < lcc.size(). i++) {         Route route = lcc.get(i).getRoute(rn.get(i)).         if (route != null) {             MasterConsumer mc = (MasterConsumer) route.getConsumer().             Field delegatedConsumer = mc.getClass().getDeclaredField("delegatedConsumer").             delegatedConsumer.setAccessible(true).             if (delegatedConsumer.get(mc) != null) {                 result++.             }         }     }     return result. }
