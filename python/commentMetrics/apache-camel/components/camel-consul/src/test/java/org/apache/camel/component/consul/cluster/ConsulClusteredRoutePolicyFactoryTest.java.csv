commented;modifiers;parameterAmount;loc;comment;code
false;public;0;12;;// ************************************ // Test // ************************************ @Test public void test() throws Exception {     for (String id : CLIENTS) {         SCHEDULER.submit(() -> run(id)).     }     LATCH.await(1, TimeUnit.MINUTES).     SCHEDULER.shutdownNow().     Assert.assertEquals(CLIENTS.size(), RESULTS.size()).     Assert.assertTrue(RESULTS.containsAll(CLIENTS)). }
false;public;0;7;;@Override public void configure() throws Exception {     from("timer:consul?delay=1s&period=1s").routeId("route-" + id).log("From ${routeId}").process(e -> contextLatch.countDown()). }
false;private,static;1;43;;// ************************************ // Run a Camel node // ************************************ private static void run(String id) {     try {         int events = ThreadLocalRandom.current().nextInt(2, 6).         CountDownLatch contextLatch = new CountDownLatch(events).         ConsulClusterService service = new ConsulClusterService().         service.setId("node-" + id).         service.setUrl(String.format("http://%s:%d", container.getContainerIpAddress(), container.getMappedPort(Consul.DEFAULT_HTTP_PORT))).         LOGGER.info("Consul URL {}", service.getUrl()).         DefaultCamelContext context = new DefaultCamelContext().         context.disableJMX().         context.setName("context-" + id).         context.addService(service).         context.addRoutePolicyFactory(ClusteredRoutePolicyFactory.forNamespace("my-ns")).         context.addRoutes(new RouteBuilder() {              @Override             public void configure() throws Exception {                 from("timer:consul?delay=1s&period=1s").routeId("route-" + id).log("From ${routeId}").process(e -> contextLatch.countDown()).             }         }).         // Start the context after some random time so the startup order         // changes for each test.         Thread.sleep(ThreadLocalRandom.current().nextInt(500)).         context.start().         contextLatch.await().         LOGGER.debug("Shutting down node {}", id).         RESULTS.add(id).         context.stop().         LATCH.countDown().     } catch (Exception e) {         LOGGER.warn("", e).     } }
