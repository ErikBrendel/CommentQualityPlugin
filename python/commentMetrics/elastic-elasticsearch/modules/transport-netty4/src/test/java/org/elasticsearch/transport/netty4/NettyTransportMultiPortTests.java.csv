commented;modifiers;parameterAmount;loc;comment;code
false;public;0;8;;@Before public void setup() {     if (NetworkUtils.SUPPORTS_V6 && randomBoolean()) {         host = "::1".     } else {         host = "127.0.0.1".     } }
false;public;0;16;;public void testThatNettyCanBindToMultiplePorts() throws Exception {     Settings settings = Settings.builder().put("network.host", host).put(TransportSettings.PORT.getKey(), // will not actually bind to this     22).put("transport.profiles.default.port", 0).put("transport.profiles.client1.port", 0).build().     ThreadPool threadPool = new TestThreadPool("tst").     try (TcpTransport transport = startTransport(settings, threadPool)) {         assertEquals(1, transport.profileBoundAddresses().size()).         assertEquals(1, transport.boundAddress().boundAddresses().length).     } finally {         terminate(threadPool).     } }
false;public;0;15;;public void testThatDefaultProfileInheritsFromStandardSettings() throws Exception {     Settings settings = Settings.builder().put("network.host", host).put(TransportSettings.PORT.getKey(), 0).put("transport.profiles.client1.port", 0).build().     ThreadPool threadPool = new TestThreadPool("tst").     try (TcpTransport transport = startTransport(settings, threadPool)) {         assertEquals(1, transport.profileBoundAddresses().size()).         assertEquals(1, transport.boundAddress().boundAddresses().length).     } finally {         terminate(threadPool).     } }
false;public;0;16;;public void testThatProfileWithoutPortSettingsFails() throws Exception {     Settings settings = Settings.builder().put("network.host", host).put(TransportSettings.PORT.getKey(), 0).put("transport.profiles.client1.whatever", "foo").build().     ThreadPool threadPool = new TestThreadPool("tst").     try {         IllegalStateException ex = expectThrows(IllegalStateException.class, () -> startTransport(settings, threadPool)).         assertEquals("profile [client1] has no port configured", ex.getMessage()).     } finally {         terminate(threadPool).     } }
false;public;0;15;;public void testThatDefaultProfilePortOverridesGeneralConfiguration() throws Exception {     Settings settings = Settings.builder().put("network.host", host).put(TransportSettings.PORT.getKey(), // will not actually bind to this     22).put("transport.profiles.default.port", 0).build().     ThreadPool threadPool = new TestThreadPool("tst").     try (TcpTransport transport = startTransport(settings, threadPool)) {         assertEquals(0, transport.profileBoundAddresses().size()).         assertEquals(1, transport.boundAddress().boundAddresses().length).     } finally {         terminate(threadPool).     } }
false;private;2;9;;private TcpTransport startTransport(Settings settings, ThreadPool threadPool) {     PageCacheRecycler recycler = new MockPageCacheRecycler(Settings.EMPTY).     TcpTransport transport = new Netty4Transport(settings, Version.CURRENT, threadPool, new NetworkService(Collections.emptyList()), recycler, new NamedWriteableRegistry(Collections.emptyList()), new NoneCircuitBreakerService()).     transport.start().     assertThat(transport.lifecycleState(), is(Lifecycle.State.STARTED)).     return transport. }
