# id;timestamp;commentText;codeText;commentWords;codeWords
AnnotationIndex -> public static void createAnnotationsIndexIfNecessary(Settings settings, Client client, ClusterState state,                                                          final ActionListener<Boolean> finalListener);1545224784;Create the .ml-annotations index with correct mappings if it does not already_exist. This index is read and written by the UI results views, so needs to_exist when there might be ML results to view.;public static void createAnnotationsIndexIfNecessary(Settings settings, Client client, ClusterState state,_                                                         final ActionListener<Boolean> finalListener) {__        final ActionListener<Boolean> createAliasListener = ActionListener.wrap(success -> {_            final IndicesAliasesRequest request = client.admin().indices().prepareAliases()_                .addAlias(INDEX_NAME, READ_ALIAS_NAME)_                .addAlias(INDEX_NAME, WRITE_ALIAS_NAME).request()__            executeAsyncWithOrigin(client.threadPool().getThreadContext(), ML_ORIGIN, request,_                ActionListener.<AcknowledgedResponse>wrap(r -> finalListener.onResponse(r.isAcknowledged()), finalListener::onFailure),_                client.admin().indices()::aliases)__        }, finalListener::onFailure)___        _        SortedMap<String, AliasOrIndex> mlLookup = state.getMetaData().getAliasAndIndexLookup().tailMap(".ml")__        if (mlLookup.isEmpty() == false && mlLookup.firstKey().startsWith(".ml")) {__            _            if (mlLookup.containsKey(INDEX_NAME) == false) {__                final TimeValue delayedNodeTimeOutSetting__                _                if (MachineLearningField.AUTODETECT_PROCESS.get(settings)) {_                    delayedNodeTimeOutSetting = UnassignedInfo.INDEX_DELAYED_NODE_LEFT_TIMEOUT_SETTING.get(settings)__                } else {_                    delayedNodeTimeOutSetting = TimeValue.ZERO__                }__                CreateIndexRequest createIndexRequest = new CreateIndexRequest(INDEX_NAME)__                try (XContentBuilder annotationsMapping = AnnotationIndex.annotationsMapping()) {_                    createIndexRequest.mapping(ElasticsearchMappings.DOC_TYPE, annotationsMapping)__                    createIndexRequest.settings(Settings.builder()_                        .put(IndexMetaData.SETTING_AUTO_EXPAND_REPLICAS, "0-1")_                        .put(IndexMetaData.SETTING_NUMBER_OF_SHARDS, "1")_                        .put(UnassignedInfo.INDEX_DELAYED_NODE_LEFT_TIMEOUT_SETTING.getKey(), delayedNodeTimeOutSetting))___                    executeAsyncWithOrigin(client.threadPool().getThreadContext(), ML_ORIGIN, createIndexRequest,_                        ActionListener.<CreateIndexResponse>wrap(_                            r -> createAliasListener.onResponse(r.isAcknowledged()),_                            e -> {_                                _                                _                                if (e instanceof ResourceAlreadyExistsException) {_                                    _                                    createAliasListener.onResponse(true)__                                } else {_                                    finalListener.onFailure(e)__                                }_                            }_                        ), client.admin().indices()::create)__                } catch (IOException e) {_                    finalListener.onFailure(e)__                }_                return__            }__            _            if (mlLookup.containsKey(READ_ALIAS_NAME) == false || mlLookup.containsKey(WRITE_ALIAS_NAME) == false) {_                createAliasListener.onResponse(true)__                return__            }_        }__        _        finalListener.onResponse(false)__    };create,the,ml,annotations,index,with,correct,mappings,if,it,does,not,already,exist,this,index,is,read,and,written,by,the,ui,results,views,so,needs,to,exist,when,there,might,be,ml,results,to,view;public,static,void,create,annotations,index,if,necessary,settings,settings,client,client,cluster,state,state,final,action,listener,boolean,final,listener,final,action,listener,boolean,create,alias,listener,action,listener,wrap,success,final,indices,aliases,request,request,client,admin,indices,prepare,aliases,add,alias,add,alias,request,execute,async,with,origin,client,thread,pool,get,thread,context,request,action,listener,acknowledged,response,wrap,r,final,listener,on,response,r,is,acknowledged,final,listener,on,failure,client,admin,indices,aliases,final,listener,on,failure,sorted,map,string,alias,or,index,ml,lookup,state,get,meta,data,get,alias,and,index,lookup,tail,map,ml,if,ml,lookup,is,empty,false,ml,lookup,first,key,starts,with,ml,if,ml,lookup,contains,key,false,final,time,value,delayed,node,time,out,setting,if,machine,learning,field,get,settings,delayed,node,time,out,setting,unassigned,info,get,settings,else,delayed,node,time,out,setting,time,value,zero,create,index,request,create,index,request,new,create,index,request,try,xcontent,builder,annotations,mapping,annotation,index,annotations,mapping,create,index,request,mapping,elasticsearch,mappings,annotations,mapping,create,index,request,settings,settings,builder,put,index,meta,data,0,1,put,index,meta,data,1,put,unassigned,info,get,key,delayed,node,time,out,setting,execute,async,with,origin,client,thread,pool,get,thread,context,create,index,request,action,listener,create,index,response,wrap,r,create,alias,listener,on,response,r,is,acknowledged,e,if,e,instanceof,resource,already,exists,exception,create,alias,listener,on,response,true,else,final,listener,on,failure,e,client,admin,indices,create,catch,ioexception,e,final,listener,on,failure,e,return,if,ml,lookup,contains,key,false,ml,lookup,contains,key,false,create,alias,listener,on,response,true,return,final,listener,on,response,false
AnnotationIndex -> public static void createAnnotationsIndexIfNecessary(Settings settings, Client client, ClusterState state,                                                          final ActionListener<Boolean> finalListener);1548776495;Create the .ml-annotations index with correct mappings if it does not already_exist. This index is read and written by the UI results views, so needs to_exist when there might be ML results to view.;public static void createAnnotationsIndexIfNecessary(Settings settings, Client client, ClusterState state,_                                                         final ActionListener<Boolean> finalListener) {__        final ActionListener<Boolean> createAliasListener = ActionListener.wrap(success -> {_            final IndicesAliasesRequest request = client.admin().indices().prepareAliases()_                .addAlias(INDEX_NAME, READ_ALIAS_NAME)_                .addAlias(INDEX_NAME, WRITE_ALIAS_NAME).request()__            executeAsyncWithOrigin(client.threadPool().getThreadContext(), ML_ORIGIN, request,_                ActionListener.<AcknowledgedResponse>wrap(r -> finalListener.onResponse(r.isAcknowledged()), finalListener::onFailure),_                client.admin().indices()::aliases)__        }, finalListener::onFailure)___        _        SortedMap<String, AliasOrIndex> mlLookup = state.getMetaData().getAliasAndIndexLookup().tailMap(".ml")__        if (mlLookup.isEmpty() == false && mlLookup.firstKey().startsWith(".ml")) {__            _            if (mlLookup.containsKey(INDEX_NAME) == false) {__                final TimeValue delayedNodeTimeOutSetting__                _                if (MachineLearningField.AUTODETECT_PROCESS.get(settings)) {_                    delayedNodeTimeOutSetting = UnassignedInfo.INDEX_DELAYED_NODE_LEFT_TIMEOUT_SETTING.get(settings)__                } else {_                    delayedNodeTimeOutSetting = TimeValue.ZERO__                }__                CreateIndexRequest createIndexRequest = new CreateIndexRequest(INDEX_NAME)__                try (XContentBuilder annotationsMapping = AnnotationIndex.annotationsMapping()) {_                    createIndexRequest.mapping(ElasticsearchMappings.DOC_TYPE, annotationsMapping)__                    createIndexRequest.settings(Settings.builder()_                        .put(IndexMetaData.SETTING_AUTO_EXPAND_REPLICAS, "0-1")_                        .put(IndexMetaData.SETTING_NUMBER_OF_SHARDS, "1")_                        .put(UnassignedInfo.INDEX_DELAYED_NODE_LEFT_TIMEOUT_SETTING.getKey(), delayedNodeTimeOutSetting))___                    executeAsyncWithOrigin(client.threadPool().getThreadContext(), ML_ORIGIN, createIndexRequest,_                        ActionListener.<CreateIndexResponse>wrap(_                            r -> createAliasListener.onResponse(r.isAcknowledged()),_                            e -> {_                                _                                _                                if (e instanceof ResourceAlreadyExistsException) {_                                    _                                    createAliasListener.onResponse(true)__                                } else {_                                    finalListener.onFailure(e)__                                }_                            }_                        ), client.admin().indices()::create)__                } catch (IOException e) {_                    finalListener.onFailure(e)__                }_                return__            }__            _            if (mlLookup.containsKey(READ_ALIAS_NAME) == false || mlLookup.containsKey(WRITE_ALIAS_NAME) == false) {_                createAliasListener.onResponse(true)__                return__            }_        }__        _        finalListener.onResponse(false)__    };create,the,ml,annotations,index,with,correct,mappings,if,it,does,not,already,exist,this,index,is,read,and,written,by,the,ui,results,views,so,needs,to,exist,when,there,might,be,ml,results,to,view;public,static,void,create,annotations,index,if,necessary,settings,settings,client,client,cluster,state,state,final,action,listener,boolean,final,listener,final,action,listener,boolean,create,alias,listener,action,listener,wrap,success,final,indices,aliases,request,request,client,admin,indices,prepare,aliases,add,alias,add,alias,request,execute,async,with,origin,client,thread,pool,get,thread,context,request,action,listener,acknowledged,response,wrap,r,final,listener,on,response,r,is,acknowledged,final,listener,on,failure,client,admin,indices,aliases,final,listener,on,failure,sorted,map,string,alias,or,index,ml,lookup,state,get,meta,data,get,alias,and,index,lookup,tail,map,ml,if,ml,lookup,is,empty,false,ml,lookup,first,key,starts,with,ml,if,ml,lookup,contains,key,false,final,time,value,delayed,node,time,out,setting,if,machine,learning,field,get,settings,delayed,node,time,out,setting,unassigned,info,get,settings,else,delayed,node,time,out,setting,time,value,zero,create,index,request,create,index,request,new,create,index,request,try,xcontent,builder,annotations,mapping,annotation,index,annotations,mapping,create,index,request,mapping,elasticsearch,mappings,annotations,mapping,create,index,request,settings,settings,builder,put,index,meta,data,0,1,put,index,meta,data,1,put,unassigned,info,get,key,delayed,node,time,out,setting,execute,async,with,origin,client,thread,pool,get,thread,context,create,index,request,action,listener,create,index,response,wrap,r,create,alias,listener,on,response,r,is,acknowledged,e,if,e,instanceof,resource,already,exists,exception,create,alias,listener,on,response,true,else,final,listener,on,failure,e,client,admin,indices,create,catch,ioexception,e,final,listener,on,failure,e,return,if,ml,lookup,contains,key,false,ml,lookup,contains,key,false,create,alias,listener,on,response,true,return,final,listener,on,response,false
