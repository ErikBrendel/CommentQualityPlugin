commented;modifiers;parameterAmount;loc;comment;code
false;protected;3;5;;@Override protected void doExecute(Task task, GetRollupCapsAction.Request request, ActionListener<GetRollupCapsAction.Response> listener) {     Map<String, RollableIndexCaps> allCaps = getCaps(request.getIndexPattern(), clusterService.state().getMetaData().indices()).     listener.onResponse(new GetRollupCapsAction.Response(allCaps)). }
false;static;2;37;;static Map<String, RollableIndexCaps> getCaps(String indexPattern, ImmutableOpenMap<String, IndexMetaData> indices) {     Map<String, List<RollupJobCaps>> allCaps = new TreeMap<>().     for (ObjectObjectCursor<String, IndexMetaData> entry : indices) {         // Does this index have rollup metadata?         TransportGetRollupCapsAction.findRollupIndexCaps(entry.key, entry.value).ifPresent(cap -> {             List<RollupJobCaps> jobCaps.             if (indexPattern.equals(MetaData.ALL)) {                 // This index has rollup metadata, and since we want _all, just process all of them                 jobCaps = cap.getJobCaps().             } else {                 // This index has rollup metadata, but is it for the index pattern that we're looking for?                 jobCaps = cap.getJobCapsByIndexPattern(indexPattern).             }             jobCaps.forEach(jobCap -> {                 String pattern = indexPattern.equals(MetaData.ALL) ? jobCap.getIndexPattern() : indexPattern.                 // Do we already have an entry for this index pattern?                 List<RollupJobCaps> indexCaps = allCaps.get(pattern).                 if (indexCaps == null) {                     indexCaps = new ArrayList<>().                 }                 indexCaps.add(jobCap).                 allCaps.put(pattern, indexCaps).             }).         }).     }     // Convert the mutable lists into the RollableIndexCaps     return allCaps.entrySet().stream().collect(Collectors.toMap(Map.Entry::getKey, e -> new RollableIndexCaps(e.getKey(), e.getValue()))). }
false;static;2;23;;static Optional<RollupIndexCaps> findRollupIndexCaps(String indexName, IndexMetaData indexMetaData) {     if (indexMetaData == null) {         return Optional.empty().     }     MappingMetaData rollupMapping = indexMetaData.getMappings().get(RollupField.TYPE_NAME).     if (rollupMapping == null) {         return Optional.empty().     }     Object objMeta = rollupMapping.getSourceAsMap().get("_meta").     if (objMeta == null) {         return Optional.empty().     }     RollupIndexCaps caps = RollupIndexCaps.parseMetadataXContent(new BytesArray(rollupMapping.source().uncompressed()), indexName).     if (caps.hasCaps()) {         return Optional.of(caps).     }     return Optional.empty(). }
