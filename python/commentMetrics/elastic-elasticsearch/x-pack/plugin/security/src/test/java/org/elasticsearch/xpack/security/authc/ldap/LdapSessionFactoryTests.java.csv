# id;timestamp;commentText;codeText;commentWords;codeWords
LdapSessionFactoryTests -> public void testSslTrustIsReloaded() throws Exception;1545957094;This test connects to the in memory LDAP server over SSL using 2 different CA certificates._One certificate is valid, the other is not._The path to the certificate never changes, but the contents are copied in place._If the realm's CA path is monitored for changes and the underlying SSL context is reloaded, then we will get two different outcomes_(one failure, one success) depending on which file content is in place.;public void testSslTrustIsReloaded() throws Exception {_        InMemoryDirectoryServer ldapServer = randomFrom(ldapServers)__        String ldapUrl = new LDAPURL("ldaps", "localhost", ldapServer.getListenPort("ldaps"), null, null, null, null).toString()__        String groupSearchBase = "o=sevenSeas"__        String userTemplates = "cn={0},ou=people,o=sevenSeas"___        Settings settings = Settings.builder()_            .put(globalSettings)_            .put(buildLdapSettings(ldapUrl, userTemplates, groupSearchBase, LdapSearchScope.SUB_TREE))_            .build()___        final Path realCa = getDataPath("/org/elasticsearch/xpack/security/authc/ldap/support/ldap-ca.crt")__        final Path fakeCa = getDataPath("/org/elasticsearch/xpack/security/authc/ldap/support/smb_ca.crt")___        final Environment environment = TestEnvironment.newEnvironment(settings)__        RealmConfig config = new RealmConfig(REALM_IDENTIFIER, settings,_            environment, new ThreadContext(settings))__        LdapSessionFactory sessionFactory = new LdapSessionFactory(config, sslService, threadPool)__        String user = "Horatio Hornblower"__        SecureString userPass = new SecureString("pass")___        final ResourceWatcherService resourceWatcher = new ResourceWatcherService(settings, threadPool)__        new SSLConfigurationReloader(environment, sslService, resourceWatcher)___        Files.copy(fakeCa, ldapCaPath, StandardCopyOption.REPLACE_EXISTING)__        resourceWatcher.notifyNow(ResourceWatcherService.Frequency.HIGH)___        UncategorizedExecutionException e =_            expectThrows(UncategorizedExecutionException.class, () -> session(sessionFactory, user, userPass))__        assertThat(e.getCause(), instanceOf(ExecutionException.class))__        assertThat(e.getCause().getCause(), instanceOf(LDAPException.class))__        assertThat(e.getCause().getCause().getMessage(), containsString("SSLPeerUnverifiedException"))___        Files.copy(realCa, ldapCaPath, StandardCopyOption.REPLACE_EXISTING)__        resourceWatcher.notifyNow(ResourceWatcherService.Frequency.HIGH)___        final LdapSession session = session(sessionFactory, user, userPass)__        assertThat(session.userDn(), is("cn=Horatio Hornblower,ou=people,o=sevenSeas"))___        session.close()__    };this,test,connects,to,the,in,memory,ldap,server,over,ssl,using,2,different,ca,certificates,one,certificate,is,valid,the,other,is,not,the,path,to,the,certificate,never,changes,but,the,contents,are,copied,in,place,if,the,realm,s,ca,path,is,monitored,for,changes,and,the,underlying,ssl,context,is,reloaded,then,we,will,get,two,different,outcomes,one,failure,one,success,depending,on,which,file,content,is,in,place;public,void,test,ssl,trust,is,reloaded,throws,exception,in,memory,directory,server,ldap,server,random,from,ldap,servers,string,ldap,url,new,ldapurl,ldaps,localhost,ldap,server,get,listen,port,ldaps,null,null,null,null,to,string,string,group,search,base,o,seven,seas,string,user,templates,cn,0,ou,people,o,seven,seas,settings,settings,settings,builder,put,global,settings,put,build,ldap,settings,ldap,url,user,templates,group,search,base,ldap,search,scope,build,final,path,real,ca,get,data,path,org,elasticsearch,xpack,security,authc,ldap,support,ldap,ca,crt,final,path,fake,ca,get,data,path,org,elasticsearch,xpack,security,authc,ldap,support,crt,final,environment,environment,test,environment,new,environment,settings,realm,config,config,new,realm,config,settings,environment,new,thread,context,settings,ldap,session,factory,session,factory,new,ldap,session,factory,config,ssl,service,thread,pool,string,user,horatio,hornblower,secure,string,user,pass,new,secure,string,pass,final,resource,watcher,service,resource,watcher,new,resource,watcher,service,settings,thread,pool,new,sslconfiguration,reloader,environment,ssl,service,resource,watcher,files,copy,fake,ca,ldap,ca,path,standard,copy,option,resource,watcher,notify,now,resource,watcher,service,frequency,high,uncategorized,execution,exception,e,expect,throws,uncategorized,execution,exception,class,session,session,factory,user,user,pass,assert,that,e,get,cause,instance,of,execution,exception,class,assert,that,e,get,cause,get,cause,instance,of,ldapexception,class,assert,that,e,get,cause,get,cause,get,message,contains,string,sslpeer,unverified,exception,files,copy,real,ca,ldap,ca,path,standard,copy,option,resource,watcher,notify,now,resource,watcher,service,frequency,high,final,ldap,session,session,session,session,factory,user,user,pass,assert,that,session,user,dn,is,cn,horatio,hornblower,ou,people,o,seven,seas,session,close
LdapSessionFactoryTests -> public void testSslTrustIsReloaded() throws Exception;1550687846;This test connects to the in memory LDAP server over SSL using 2 different CA certificates._One certificate is valid, the other is not._The path to the certificate never changes, but the contents are copied in place._If the realm's CA path is monitored for changes and the underlying SSL context is reloaded, then we will get two different outcomes_(one failure, one success) depending on which file content is in place.;public void testSslTrustIsReloaded() throws Exception {_        InMemoryDirectoryServer ldapServer = randomFrom(ldapServers)__        InetAddress listenAddress = ldapServer.getListenAddress("ldaps")__        if (listenAddress == null) {_            listenAddress = InetAddress.getLoopbackAddress()__        }_        String ldapUrl = new LDAPURL("ldaps", NetworkAddress.format(listenAddress), ldapServer.getListenPort("ldaps"),_            null, null, null, null).toString()__        String groupSearchBase = "o=sevenSeas"__        String userTemplates = "cn={0},ou=people,o=sevenSeas"___        Settings settings = Settings.builder()_            .put(globalSettings)_            .put(buildLdapSettings(ldapUrl, userTemplates, groupSearchBase, LdapSearchScope.SUB_TREE))_            .build()___        final Path realCa = getDataPath("/org/elasticsearch/xpack/security/authc/ldap/support/ldap-ca.crt")__        final Path fakeCa = getDataPath("/org/elasticsearch/xpack/security/authc/ldap/support/smb_ca.crt")___        final Environment environment = TestEnvironment.newEnvironment(settings)__        RealmConfig config = new RealmConfig(REALM_IDENTIFIER, settings,_            environment, new ThreadContext(settings))__        LdapSessionFactory sessionFactory = new LdapSessionFactory(config, sslService, threadPool)__        String user = "Horatio Hornblower"__        SecureString userPass = new SecureString("pass")___        final ResourceWatcherService resourceWatcher = new ResourceWatcherService(settings, threadPool)__        new SSLConfigurationReloader(environment, sslService, resourceWatcher)___        Files.copy(fakeCa, ldapCaPath, StandardCopyOption.REPLACE_EXISTING)__        resourceWatcher.notifyNow(ResourceWatcherService.Frequency.HIGH)___        UncategorizedExecutionException e =_            expectThrows(UncategorizedExecutionException.class, () -> session(sessionFactory, user, userPass))__        assertThat(e.getCause(), instanceOf(ExecutionException.class))__        assertThat(e.getCause().getCause(), instanceOf(LDAPException.class))__        assertThat(e.getCause().getCause().getMessage(), containsString("SSLPeerUnverifiedException"))___        Files.copy(realCa, ldapCaPath, StandardCopyOption.REPLACE_EXISTING)__        resourceWatcher.notifyNow(ResourceWatcherService.Frequency.HIGH)___        final LdapSession session = session(sessionFactory, user, userPass)__        assertThat(session.userDn(), is("cn=Horatio Hornblower,ou=people,o=sevenSeas"))___        session.close()__    };this,test,connects,to,the,in,memory,ldap,server,over,ssl,using,2,different,ca,certificates,one,certificate,is,valid,the,other,is,not,the,path,to,the,certificate,never,changes,but,the,contents,are,copied,in,place,if,the,realm,s,ca,path,is,monitored,for,changes,and,the,underlying,ssl,context,is,reloaded,then,we,will,get,two,different,outcomes,one,failure,one,success,depending,on,which,file,content,is,in,place;public,void,test,ssl,trust,is,reloaded,throws,exception,in,memory,directory,server,ldap,server,random,from,ldap,servers,inet,address,listen,address,ldap,server,get,listen,address,ldaps,if,listen,address,null,listen,address,inet,address,get,loopback,address,string,ldap,url,new,ldapurl,ldaps,network,address,format,listen,address,ldap,server,get,listen,port,ldaps,null,null,null,null,to,string,string,group,search,base,o,seven,seas,string,user,templates,cn,0,ou,people,o,seven,seas,settings,settings,settings,builder,put,global,settings,put,build,ldap,settings,ldap,url,user,templates,group,search,base,ldap,search,scope,build,final,path,real,ca,get,data,path,org,elasticsearch,xpack,security,authc,ldap,support,ldap,ca,crt,final,path,fake,ca,get,data,path,org,elasticsearch,xpack,security,authc,ldap,support,crt,final,environment,environment,test,environment,new,environment,settings,realm,config,config,new,realm,config,settings,environment,new,thread,context,settings,ldap,session,factory,session,factory,new,ldap,session,factory,config,ssl,service,thread,pool,string,user,horatio,hornblower,secure,string,user,pass,new,secure,string,pass,final,resource,watcher,service,resource,watcher,new,resource,watcher,service,settings,thread,pool,new,sslconfiguration,reloader,environment,ssl,service,resource,watcher,files,copy,fake,ca,ldap,ca,path,standard,copy,option,resource,watcher,notify,now,resource,watcher,service,frequency,high,uncategorized,execution,exception,e,expect,throws,uncategorized,execution,exception,class,session,session,factory,user,user,pass,assert,that,e,get,cause,instance,of,execution,exception,class,assert,that,e,get,cause,get,cause,instance,of,ldapexception,class,assert,that,e,get,cause,get,cause,get,message,contains,string,sslpeer,unverified,exception,files,copy,real,ca,ldap,ca,path,standard,copy,option,resource,watcher,notify,now,resource,watcher,service,frequency,high,final,ldap,session,session,session,session,factory,user,user,pass,assert,that,session,user,dn,is,cn,horatio,hornblower,ou,people,o,seven,seas,session,close
