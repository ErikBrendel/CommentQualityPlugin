commented;modifiers;parameterAmount;loc;comment;code
false;public;0;10;;public void testExecute() {     assertMove(OperationMode.RUNNING, OperationMode.STOPPING).     assertMove(OperationMode.STOPPING, randomFrom(OperationMode.RUNNING, OperationMode.STOPPED)).     assertMove(OperationMode.STOPPED, OperationMode.RUNNING).     OperationMode mode = randomFrom(OperationMode.values()).     assertNoMove(mode, mode).     assertNoMove(OperationMode.STOPPED, OperationMode.STOPPING).     assertNoMove(OperationMode.RUNNING, OperationMode.STOPPED). }
false;public;0;11;;public void testExecuteWithEmptyMetadata() {     OperationMode requestedMode = OperationMode.STOPPING.     OperationMode newMode = executeUpdate(false, IndexLifecycleMetadata.EMPTY.getOperationMode(), requestedMode, false).     assertThat(newMode, equalTo(requestedMode)).     requestedMode = randomFrom(OperationMode.RUNNING, OperationMode.STOPPED).     newMode = executeUpdate(false, IndexLifecycleMetadata.EMPTY.getOperationMode(), requestedMode, false).     assertThat(newMode, equalTo(OperationMode.RUNNING)). }
false;private;2;4;;private void assertMove(OperationMode currentMode, OperationMode requestedMode) {     OperationMode newMode = executeUpdate(true, currentMode, requestedMode, false).     assertThat(newMode, equalTo(requestedMode)). }
false;private;2;4;;private void assertNoMove(OperationMode currentMode, OperationMode requestedMode) {     OperationMode newMode = executeUpdate(true, currentMode, requestedMode, true).     assertThat(newMode, equalTo(currentMode)). }
false;private;4;21;;private OperationMode executeUpdate(boolean metadataInstalled, OperationMode currentMode, OperationMode requestMode, boolean assertSameClusterState) {     IndexLifecycleMetadata indexLifecycleMetadata = new IndexLifecycleMetadata(Collections.emptyMap(), currentMode).     ImmutableOpenMap.Builder<String, MetaData.Custom> customsMapBuilder = ImmutableOpenMap.builder().     MetaData.Builder metaData = MetaData.builder().persistentSettings(settings(Version.CURRENT).build()).     if (metadataInstalled) {         metaData.customs(customsMapBuilder.fPut(IndexLifecycleMetadata.TYPE, indexLifecycleMetadata).build()).     }     ClusterState state = ClusterState.builder(ClusterName.DEFAULT).metaData(metaData).build().     OperationModeUpdateTask task = new OperationModeUpdateTask(requestMode).     ClusterState newState = task.execute(state).     if (assertSameClusterState) {         assertSame(state, newState).     } else {         assertThat(state, not(equalTo(newState))).     }     IndexLifecycleMetadata newMetaData = newState.metaData().custom(IndexLifecycleMetadata.TYPE).     assertThat(newMetaData.getPolicyMetadatas(), equalTo(indexLifecycleMetadata.getPolicyMetadatas())).     return newMetaData.getOperationMode(). }
