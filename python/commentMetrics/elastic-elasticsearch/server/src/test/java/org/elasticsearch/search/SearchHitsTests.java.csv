commented;modifiers;parameterAmount;loc;comment;code
false;public,static;2;3;;public static SearchHits createTestItem(boolean withOptionalInnerHits, boolean withShardTarget) {     return createTestItem(randomFrom(XContentType.values()), withOptionalInnerHits, withShardTarget). }
false;private,static;4;8;;private static SearchHit[] createSearchHitArray(int size, XContentType xContentType, boolean withOptionalInnerHits, boolean transportSerialization) {     SearchHit[] hits = new SearchHit[size].     for (int i = 0. i < hits.length. i++) {         hits[i] = SearchHitTests.createTestItem(xContentType, withOptionalInnerHits, transportSerialization).     }     return hits. }
false;private,static;1;4;;private static TotalHits randomTotalHits(TotalHits.Relation relation) {     long totalHits = TestUtil.nextLong(random(), 0, Long.MAX_VALUE).     return new TotalHits(totalHits, relation). }
false;public,static;3;3;;public static SearchHits createTestItem(XContentType xContentType, boolean withOptionalInnerHits, boolean transportSerialization) {     return createTestItem(xContentType, withOptionalInnerHits, transportSerialization, randomFrom(TotalHits.Relation.values())). }
false;private,static;4;16;;private static SearchHits createTestItem(XContentType xContentType, boolean withOptionalInnerHits, boolean transportSerialization, TotalHits.Relation totalHitsRelation) {     int searchHits = randomIntBetween(0, 5).     SearchHit[] hits = createSearchHitArray(searchHits, xContentType, withOptionalInnerHits, transportSerialization).     TotalHits totalHits = frequently() ? randomTotalHits(totalHitsRelation) : null.     float maxScore = frequently() ? randomFloat() : Float.NaN.     SortField[] sortFields = null.     String collapseField = null.     Object[] collapseValues = null.     if (transportSerialization) {         sortFields = randomBoolean() ? createSortFields(randomIntBetween(1, 5)) : null.         collapseField = randomAlphaOfLengthBetween(5, 10).         collapseValues = randomBoolean() ? createCollapseValues(randomIntBetween(1, 10)) : null.     }     return new SearchHits(hits, totalHits, maxScore, sortFields, collapseField, collapseValues). }
false;private,static;1;9;;private static SortField[] createSortFields(int size) {     SortField[] sortFields = new SortField[size].     for (int i = 0. i < sortFields.length. i++) {         // sort fields are simplified before serialization, we write directly the simplified version         // otherwise equality comparisons become complicated         sortFields[i] = LuceneTests.randomSortField().v2().     }     return sortFields. }
false;private,static;1;7;;private static Object[] createCollapseValues(int size) {     Object[] collapseValues = new Object[size].     for (int i = 0. i < collapseValues.length. i++) {         collapseValues[i] = LuceneTests.randomSortValue().     }     return collapseValues. }
false;protected;1;54;;@Override protected SearchHits mutateInstance(SearchHits instance) {     switch(randomIntBetween(0, 5)) {         case 0:             return new SearchHits(createSearchHitArray(instance.getHits().length + 1, randomFrom(XContentType.values()), false, randomBoolean()), instance.getTotalHits(), instance.getMaxScore()).         case 1:             final TotalHits totalHits.             if (instance.getTotalHits() == null) {                 totalHits = randomTotalHits(randomFrom(TotalHits.Relation.values())).             } else {                 totalHits = null.             }             return new SearchHits(instance.getHits(), totalHits, instance.getMaxScore()).         case 2:             final float maxScore.             if (Float.isNaN(instance.getMaxScore())) {                 maxScore = randomFloat().             } else {                 maxScore = Float.NaN.             }             return new SearchHits(instance.getHits(), instance.getTotalHits(), maxScore).         case 3:             SortField[] sortFields.             if (instance.getSortFields() == null) {                 sortFields = createSortFields(randomIntBetween(1, 5)).             } else {                 sortFields = randomBoolean() ? createSortFields(instance.getSortFields().length + 1) : null.             }             return new SearchHits(instance.getHits(), instance.getTotalHits(), instance.getMaxScore(), sortFields, instance.getCollapseField(), instance.getCollapseValues()).         case 4:             String collapseField.             if (instance.getCollapseField() == null) {                 collapseField = randomAlphaOfLengthBetween(5, 10).             } else {                 collapseField = randomBoolean() ? instance.getCollapseField() + randomAlphaOfLengthBetween(2, 5) : null.             }             return new SearchHits(instance.getHits(), instance.getTotalHits(), instance.getMaxScore(), instance.getSortFields(), collapseField, instance.getCollapseValues()).         case 5:             Object[] collapseValues.             if (instance.getCollapseValues() == null) {                 collapseValues = createCollapseValues(randomIntBetween(1, 5)).             } else {                 collapseValues = randomBoolean() ? createCollapseValues(instance.getCollapseValues().length + 1) : null.             }             return new SearchHits(instance.getHits(), instance.getTotalHits(), instance.getMaxScore(), instance.getSortFields(), instance.getCollapseField(), collapseValues).         default:             throw new UnsupportedOperationException().     } }
false;protected;0;5;;@Override protected Predicate<String> getRandomFieldsExcludeFilter() {     return path -> (path.isEmpty() || path.contains("inner_hits") || path.contains("highlight") || path.contains("fields") || path.contains("_source")). }
false;protected;0;4;;@Override protected String[] getShuffleFieldsExceptions() {     return new String[] { "_source" }. }
false;protected;0;4;;@Override protected Writeable.Reader<SearchHits> instanceReader() {     return SearchHits::new. }
false;protected;0;7;;@Override protected SearchHits createTestInstance() {     // in this layer.     return createTestItem(randomFrom(XContentType.values()), true, true). }
false;protected;1;9;;@Override protected SearchHits createXContextTestInstance(XContentType xContentType) {     // rest serialization with shard targets.     return createTestItem(xContentType, true, false). }
false;protected;1;11;;@Override protected SearchHits doParseInstance(XContentParser parser) throws IOException {     assertEquals(XContentParser.Token.START_OBJECT, parser.nextToken()).     assertEquals(XContentParser.Token.FIELD_NAME, parser.nextToken()).     assertEquals(SearchHits.Fields.HITS, parser.currentName()).     assertEquals(XContentParser.Token.START_OBJECT, parser.nextToken()).     SearchHits searchHits = SearchHits.fromXContent(parser).     assertEquals(XContentParser.Token.END_OBJECT, parser.currentToken()).     assertEquals(XContentParser.Token.END_OBJECT, parser.nextToken()).     return searchHits. }
false;public;0;16;;public void testToXContent() throws IOException {     SearchHit[] hits = new SearchHit[] { new SearchHit(1, "id1", new Text("type"), Collections.emptyMap()), new SearchHit(2, "id2", new Text("type"), Collections.emptyMap()) }.     long totalHits = 1000.     float maxScore = 1.5f.     SearchHits searchHits = new SearchHits(hits, new TotalHits(totalHits, TotalHits.Relation.EQUAL_TO), maxScore).     XContentBuilder builder = JsonXContent.contentBuilder().     builder.startObject().     searchHits.toXContent(builder, ToXContent.EMPTY_PARAMS).     builder.endObject().     assertEquals("{\"hits\":{\"total\":{\"value\":1000,\"relation\":\"eq\"},\"max_score\":1.5," + "\"hits\":[{\"_type\":\"type\",\"_id\":\"id1\",\"_score\":null}," + "{\"_type\":\"type\",\"_id\":\"id2\",\"_score\":null}]}}", Strings.toString(builder)). }
false;public;0;48;;public void testFromXContentWithShards() throws IOException {     for (boolean withExplanation : new boolean[] { true, false }) {         final SearchHit[] hits = new SearchHit[] { new SearchHit(1, "id1", new Text("type"), Collections.emptyMap()), new SearchHit(2, "id2", new Text("type"), Collections.emptyMap()), new SearchHit(10, "id10", new Text("type"), Collections.emptyMap()) }.         for (SearchHit hit : hits) {             String index = randomAlphaOfLengthBetween(5, 10).             String clusterAlias = randomBoolean() ? null : randomAlphaOfLengthBetween(5, 10).             final SearchShardTarget shardTarget = new SearchShardTarget(randomAlphaOfLengthBetween(5, 10), new ShardId(new Index(index, randomAlphaOfLengthBetween(5, 10)), randomInt()), clusterAlias, OriginalIndices.NONE).             if (withExplanation) {                 hit.explanation(SearchHitTests.createExplanation(randomIntBetween(0, 5))).             }             hit.shard(shardTarget).         }         long totalHits = 1000.         float maxScore = 1.5f.         SearchHits searchHits = new SearchHits(hits, new TotalHits(totalHits, TotalHits.Relation.EQUAL_TO), maxScore).         XContentType xContentType = randomFrom(XContentType.values()).         BytesReference bytes = toShuffledXContent(searchHits, xContentType, ToXContent.EMPTY_PARAMS, false).         try (XContentParser parser = xContentType.xContent().createParser(xContentRegistry(), LoggingDeprecationHandler.INSTANCE, bytes.streamInput())) {             SearchHits newSearchHits = doParseInstance(parser).             assertEquals(3, newSearchHits.getHits().length).             assertEquals("id1", newSearchHits.getAt(0).getId()).             for (int i = 0. i < hits.length. i++) {                 assertEquals(hits[i].getExplanation(), newSearchHits.getAt(i).getExplanation()).                 if (withExplanation) {                     assertEquals(hits[i].getShard().getIndex(), newSearchHits.getAt(i).getShard().getIndex()).                     assertEquals(hits[i].getShard().getShardId().getId(), newSearchHits.getAt(i).getShard().getShardId().getId()).                     assertEquals(hits[i].getShard().getShardId().getIndexName(), newSearchHits.getAt(i).getShard().getShardId().getIndexName()).                     assertEquals(hits[i].getShard().getNodeId(), newSearchHits.getAt(i).getShard().getNodeId()).                     // The index uuid is not serialized in the rest layer                     assertNotEquals(hits[i].getShard().getShardId().getIndex().getUUID(), newSearchHits.getAt(i).getShard().getShardId().getIndex().getUUID()).                 } else {                     assertNull(newSearchHits.getAt(i).getShard()).                 }             }         }     } }
false;public;0;14;;public void testReadFromPre6_6_0() throws IOException {     try (StreamInput in = StreamInput.wrap(Base64.getDecoder().decode("AQC/gAAAAAA="))) {         in.setVersion(VersionUtils.randomVersionBetween(random(), Version.V_6_0_0, VersionUtils.getPreviousVersion(Version.V_6_6_0))).         SearchHits searchHits = new SearchHits(in).         assertEquals(0, searchHits.getHits().length).         assertNotNull(searchHits.getTotalHits()).         assertEquals(0L, searchHits.getTotalHits().value).         assertEquals(TotalHits.Relation.EQUAL_TO, searchHits.getTotalHits().relation).         assertEquals(-1F, searchHits.getMaxScore(), 0F).         assertNull(searchHits.getSortFields()).         assertNull(searchHits.getCollapseField()).         assertNull(searchHits.getCollapseValues()).     } }
false;public;0;17;;public void testSerializationPre6_6_0() throws IOException {     Version version = VersionUtils.randomVersionBetween(random(), Version.V_6_0_0, VersionUtils.getPreviousVersion(Version.V_6_6_0)).     SearchHits original = createTestItem(randomFrom(XContentType.values()), false, true, TotalHits.Relation.EQUAL_TO).     SearchHits deserialized = copyInstance(original, version).     assertArrayEquals(original.getHits(), deserialized.getHits()).     assertEquals(original.getMaxScore(), deserialized.getMaxScore(), 0F).     if (original.getTotalHits() == null) {         assertNull(deserialized.getTotalHits()).     } else {         assertNotNull(deserialized.getTotalHits()).         assertEquals(original.getTotalHits().value, deserialized.getTotalHits().value).         assertEquals(original.getTotalHits().relation, deserialized.getTotalHits().relation).     }     assertNull(deserialized.getSortFields()).     assertNull(deserialized.getCollapseField()).     assertNull(deserialized.getCollapseValues()). }
