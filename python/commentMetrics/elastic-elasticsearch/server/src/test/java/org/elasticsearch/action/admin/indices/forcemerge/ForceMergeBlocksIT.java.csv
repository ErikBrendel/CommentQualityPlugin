commented;modifiers;parameterAmount;loc;comment;code
false;public;0;45;;public void testForceMergeWithBlocks() {     createIndex("test").     ensureGreen("test").     NumShards numShards = getNumShards("test").     int docs = between(10, 100).     for (int i = 0. i < docs. i++) {         client().prepareIndex("test", "type", "" + i).setSource("test", "init").execute().actionGet().     }     // Request is not blocked     for (String blockSetting : Arrays.asList(SETTING_BLOCKS_READ, SETTING_BLOCKS_WRITE)) {         try {             enableIndexBlock("test", blockSetting).             ForceMergeResponse response = client().admin().indices().prepareForceMerge("test").execute().actionGet().             assertNoFailures(response).             assertThat(response.getSuccessfulShards(), equalTo(numShards.totalNumShards)).         } finally {             disableIndexBlock("test", blockSetting).         }     }     // Request is blocked     for (String blockSetting : Arrays.asList(SETTING_READ_ONLY, SETTING_BLOCKS_METADATA, SETTING_READ_ONLY_ALLOW_DELETE)) {         try {             enableIndexBlock("test", blockSetting).             assertBlocked(client().admin().indices().prepareForceMerge("test")).         } finally {             disableIndexBlock("test", blockSetting).         }     }     // Merging all indices is blocked when the cluster is read-only     try {         ForceMergeResponse response = client().admin().indices().prepareForceMerge().execute().actionGet().         assertNoFailures(response).         assertThat(response.getSuccessfulShards(), equalTo(numShards.totalNumShards)).         setClusterReadOnly(true).         assertBlocked(client().admin().indices().prepareForceMerge()).     } finally {         setClusterReadOnly(false).     } }
