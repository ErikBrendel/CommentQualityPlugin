commented;modifiers;parameterAmount;loc;comment;code
false;protected;2;13;;@Override protected PercentilesBucketPipelineAggregationBuilder doCreateTestAggregatorFactory(String name, String bucketsPath) {     PercentilesBucketPipelineAggregationBuilder factory = new PercentilesBucketPipelineAggregationBuilder(name, bucketsPath).     if (randomBoolean()) {         int numPercents = randomIntBetween(1, 20).         double[] percents = new double[numPercents].         for (int i = 0. i < numPercents. i++) {             percents[i] = randomDoubleBetween(0.0, 100.0, false).         }         factory.setPercents(percents).     }     return factory. }
false;public;0;15;;public void testPercentsFromMixedArray() throws Exception {     XContentBuilder content = XContentFactory.jsonBuilder().startObject().startObject("name").startObject("percentiles_bucket").field("buckets_path", "test").array("percents", 0, 20.0, 50, 75.99).endObject().endObject().endObject().     PercentilesBucketPipelineAggregationBuilder builder = (PercentilesBucketPipelineAggregationBuilder) parse(createParser(content)).     assertThat(builder.getPercents(), equalTo(new double[] { 0.0, 20.0, 50.0, 75.99 })). }
false;public;0;27;;public void testValidate() {     AggregationBuilder singleBucketAgg = new GlobalAggregationBuilder("global").     AggregationBuilder multiBucketAgg = new TermsAggregationBuilder("terms", ValueType.STRING).     final Set<AggregationBuilder> aggBuilders = new HashSet<>().     aggBuilders.add(singleBucketAgg).     aggBuilders.add(multiBucketAgg).     // First try to point to a non-existent agg     final PercentilesBucketPipelineAggregationBuilder builder = new PercentilesBucketPipelineAggregationBuilder("name", "invalid_agg>metric").     IllegalArgumentException ex = expectThrows(IllegalArgumentException.class, () -> builder.validate(null, aggBuilders, Collections.emptySet())).     assertEquals(PipelineAggregator.Parser.BUCKETS_PATH.getPreferredName() + " aggregation does not exist for aggregation [name]: invalid_agg>metric", ex.getMessage()).     // Now try to point to a single bucket agg     PercentilesBucketPipelineAggregationBuilder builder2 = new PercentilesBucketPipelineAggregationBuilder("name", "global>metric").     ex = expectThrows(IllegalArgumentException.class, () -> builder2.validate(null, aggBuilders, Collections.emptySet())).     assertEquals("The first aggregation in " + PipelineAggregator.Parser.BUCKETS_PATH.getPreferredName() + " must be a multi-bucket aggregation for aggregation [name] found :" + GlobalAggregationBuilder.class.getName() + " for buckets path: global>metric", ex.getMessage()).     // Now try to point to a valid multi-bucket agg (no exception should be     // thrown)     PercentilesBucketPipelineAggregationBuilder builder3 = new PercentilesBucketPipelineAggregationBuilder("name", "terms>metric").     builder3.validate(null, aggBuilders, Collections.emptySet()). }
