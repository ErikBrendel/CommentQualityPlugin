commented;modifiers;parameterAmount;loc;comment;code
false;public;0;37;;public void testFilterSizeLimitation() throws Exception {     // filter size grater than max size should thrown a exception     QueryShardContext queryShardContext = mock(QueryShardContext.class).     IndexShard indexShard = mock(IndexShard.class).     Settings settings = Settings.builder().put("index.max_adjacency_matrix_filters", 2).put(IndexMetaData.SETTING_VERSION_CREATED, Version.CURRENT).put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS, 1).put(IndexMetaData.SETTING_NUMBER_OF_SHARDS, 2).build().     IndexMetaData indexMetaData = IndexMetaData.builder("index").settings(settings).build().     IndexSettings indexSettings = new IndexSettings(indexMetaData, Settings.EMPTY).     when(indexShard.indexSettings()).thenReturn(indexSettings).     SearchContext context = new TestSearchContext(queryShardContext, indexShard).     Map<String, QueryBuilder> filters = new HashMap<>(3).     for (int i = 0. i < 3. i++) {         QueryBuilder queryBuilder = mock(QueryBuilder.class).         // return builder itself to skip rewrite         when(queryBuilder.rewrite(queryShardContext)).thenReturn(queryBuilder).         filters.put("filter" + i, queryBuilder).     }     AdjacencyMatrixAggregationBuilder builder = new AdjacencyMatrixAggregationBuilder("dummy", filters).     IllegalArgumentException ex = expectThrows(IllegalArgumentException.class, () -> builder.doBuild(context, null, new AggregatorFactories.Builder())).     assertThat(ex.getMessage(), equalTo("Number of filters is too large, must be less than or equal to: [2] but was [3]." + "This limit can be set by changing the [" + IndexSettings.MAX_ADJACENCY_MATRIX_FILTERS_SETTING.getKey() + "] index level setting.")).     // filter size not grater than max size should return an instance of AdjacencyMatrixAggregatorFactory     Map<String, QueryBuilder> emptyFilters = Collections.emptyMap().     AdjacencyMatrixAggregationBuilder aggregationBuilder = new AdjacencyMatrixAggregationBuilder("dummy", emptyFilters).     AggregatorFactory<?> factory = aggregationBuilder.doBuild(context, null, new AggregatorFactories.Builder()).     assertThat(factory instanceof AdjacencyMatrixAggregatorFactory, is(true)).     assertThat(factory.name(), equalTo("dummy")). }
