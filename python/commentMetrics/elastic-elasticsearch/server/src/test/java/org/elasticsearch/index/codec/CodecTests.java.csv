commented;modifiers;parameterAmount;loc;comment;code
false;public;0;6;;public void testResolveDefaultCodecs() throws Exception {     CodecService codecService = createCodecService().     assertThat(codecService.codec("default"), instanceOf(PerFieldMappingPostingFormatCodec.class)).     assertThat(codecService.codec("default"), instanceOf(Lucene80Codec.class)).     assertThat(codecService.codec("Lucene80"), instanceOf(Lucene80Codec.class)). }
false;public;0;4;;public void testDefault() throws Exception {     Codec codec = createCodecService().codec("default").     assertCompressionEquals(Mode.BEST_SPEED, codec). }
false;public;0;4;;public void testBestCompression() throws Exception {     Codec codec = createCodecService().codec("best_compression").     assertCompressionEquals(Mode.BEST_COMPRESSION, codec). }
true;private;2;16;// write some docs with it, inspect .si to see this was the used compression ;// write some docs with it, inspect .si to see this was the used compression private void assertCompressionEquals(Mode expected, Codec actual) throws Exception {     Directory dir = newDirectory().     IndexWriterConfig iwc = newIndexWriterConfig(null).     iwc.setCodec(actual).     IndexWriter iw = new IndexWriter(dir, iwc).     iw.addDocument(new Document()).     iw.commit().     iw.close().     DirectoryReader ir = DirectoryReader.open(dir).     SegmentReader sr = (SegmentReader) ir.leaves().get(0).reader().     String v = sr.getSegmentInfo().info.getAttribute(Lucene50StoredFieldsFormat.MODE_KEY).     assertNotNull(v).     assertEquals(expected, Mode.valueOf(v)).     ir.close().     dir.close(). }
false;private;0;12;;private CodecService createCodecService() throws IOException {     Settings nodeSettings = Settings.builder().put(Environment.PATH_HOME_SETTING.getKey(), createTempDir()).build().     IndexSettings settings = IndexSettingsModule.newIndexSettings("_na", nodeSettings).     SimilarityService similarityService = new SimilarityService(settings, null, Collections.emptyMap()).     IndexAnalyzers indexAnalyzers = createTestAnalysis(settings, nodeSettings).indexAnalyzers.     MapperRegistry mapperRegistry = new MapperRegistry(Collections.emptyMap(), Collections.emptyMap(), MapperPlugin.NOOP_FIELD_FILTER).     MapperService service = new MapperService(settings, indexAnalyzers, xContentRegistry(), similarityService, mapperRegistry, () -> null).     return new CodecService(service, LogManager.getLogger("test")). }
