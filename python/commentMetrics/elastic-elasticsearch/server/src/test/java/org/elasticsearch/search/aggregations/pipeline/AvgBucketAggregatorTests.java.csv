# id;timestamp;commentText;codeText;commentWords;codeWords
AvgBucketAggregatorTests -> public void testSameAggNames() throws IOException;1540486836;Test for issue #30608.  Under the following circumstances:__A. Multi-bucket agg in the first entry of our internal list_B. Regular agg as the immediate child of the multi-bucket in A_C. Regular agg with the same name as B at the top level, listed as the second entry in our internal list_D. Finally, a pipeline agg with the path down to B__BucketMetrics reduction would throw a class cast exception due to bad subpathing.  This test ensures_it is fixed.__Note: we have this test inside of the `avg_bucket` package so that we can get access to the package-private_`doReduce()` needed for testing this;public void testSameAggNames() throws IOException {_        Query query = new MatchAllDocsQuery()___        AvgAggregationBuilder avgBuilder = new AvgAggregationBuilder("foo").field(VALUE_FIELD)__        DateHistogramAggregationBuilder histo = new DateHistogramAggregationBuilder("histo")_            .dateHistogramInterval(DateHistogramInterval.YEAR)_            .field(DATE_FIELD)_            .subAggregation(new AvgAggregationBuilder("foo").field(VALUE_FIELD))___        AvgBucketPipelineAggregationBuilder avgBucketBuilder_            = new AvgBucketPipelineAggregationBuilder("the_avg_bucket", "histo>foo")___        try (Directory directory = newDirectory()) {_            try (RandomIndexWriter indexWriter = new RandomIndexWriter(random(), directory)) {_                Document document = new Document()__                for (String date : dataset) {_                    if (frequently()) {_                        indexWriter.commit()__                    }__                    document.add(new SortedNumericDocValuesField(DATE_FIELD, asLong(date)))__                    document.add(new SortedNumericDocValuesField(VALUE_FIELD, randomInt()))__                    indexWriter.addDocument(document)__                    document.clear()__                }_            }__            InternalAvg avgResult__            InternalDateHistogram histogramResult__            try (IndexReader indexReader = DirectoryReader.open(directory)) {_                IndexSearcher indexSearcher = newSearcher(indexReader, true, true)___                DateFieldMapper.Builder builder = new DateFieldMapper.Builder("histo")__                DateFieldMapper.DateFieldType fieldType = builder.fieldType()__                fieldType.setHasDocValues(true)__                fieldType.setName(DATE_FIELD)___                MappedFieldType valueFieldType = new NumberFieldMapper.NumberFieldType(NumberFieldMapper.NumberType.LONG)__                valueFieldType.setName(VALUE_FIELD)__                valueFieldType.setHasDocValues(true)___                avgResult = searchAndReduce(indexSearcher, query, avgBuilder, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__                histogramResult = searchAndReduce(indexSearcher, query, histo, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__            }__            _            PipelineAggregator avgBucketAgg = avgBucketBuilder.createInternal(Collections.emptyMap())__            List<Aggregation> reducedAggs = new ArrayList<>(2)___            _            reducedAggs.add(histogramResult)__            reducedAggs.add(avgResult)__            Aggregations aggregations = new Aggregations(reducedAggs)__            InternalAggregation pipelineResult = ((AvgBucketPipelineAggregator)avgBucketAgg).doReduce(aggregations, null)__            assertNotNull(pipelineResult)__        }_    };test,for,issue,30608,under,the,following,circumstances,a,multi,bucket,agg,in,the,first,entry,of,our,internal,list,b,regular,agg,as,the,immediate,child,of,the,multi,bucket,in,a,c,regular,agg,with,the,same,name,as,b,at,the,top,level,listed,as,the,second,entry,in,our,internal,list,d,finally,a,pipeline,agg,with,the,path,down,to,b,bucket,metrics,reduction,would,throw,a,class,cast,exception,due,to,bad,subpathing,this,test,ensures,it,is,fixed,note,we,have,this,test,inside,of,the,package,so,that,we,can,get,access,to,the,package,private,do,reduce,needed,for,testing,this;public,void,test,same,agg,names,throws,ioexception,query,query,new,match,all,docs,query,avg,aggregation,builder,avg,builder,new,avg,aggregation,builder,foo,field,date,histogram,aggregation,builder,histo,new,date,histogram,aggregation,builder,histo,date,histogram,interval,date,histogram,interval,year,field,sub,aggregation,new,avg,aggregation,builder,foo,field,avg,bucket,pipeline,aggregation,builder,avg,bucket,builder,new,avg,bucket,pipeline,aggregation,builder,histo,foo,try,directory,directory,new,directory,try,random,index,writer,index,writer,new,random,index,writer,random,directory,document,document,new,document,for,string,date,dataset,if,frequently,index,writer,commit,document,add,new,sorted,numeric,doc,values,field,as,long,date,document,add,new,sorted,numeric,doc,values,field,random,int,index,writer,add,document,document,document,clear,internal,avg,avg,result,internal,date,histogram,histogram,result,try,index,reader,index,reader,directory,reader,open,directory,index,searcher,index,searcher,new,searcher,index,reader,true,true,date,field,mapper,builder,builder,new,date,field,mapper,builder,histo,date,field,mapper,date,field,type,field,type,builder,field,type,field,type,set,has,doc,values,true,field,type,set,name,mapped,field,type,value,field,type,new,number,field,mapper,number,field,type,number,field,mapper,number,type,long,value,field,type,set,name,value,field,type,set,has,doc,values,true,avg,result,search,and,reduce,index,searcher,query,avg,builder,10000,null,new,mapped,field,type,field,type,value,field,type,histogram,result,search,and,reduce,index,searcher,query,histo,10000,null,new,mapped,field,type,field,type,value,field,type,pipeline,aggregator,avg,bucket,agg,avg,bucket,builder,create,internal,collections,empty,map,list,aggregation,reduced,aggs,new,array,list,2,reduced,aggs,add,histogram,result,reduced,aggs,add,avg,result,aggregations,aggregations,new,aggregations,reduced,aggs,internal,aggregation,pipeline,result,avg,bucket,pipeline,aggregator,avg,bucket,agg,do,reduce,aggregations,null,assert,not,null,pipeline,result
AvgBucketAggregatorTests -> public void testSameAggNames() throws IOException;1544232221;Test for issue #30608.  Under the following circumstances:__A. Multi-bucket agg in the first entry of our internal list_B. Regular agg as the immediate child of the multi-bucket in A_C. Regular agg with the same name as B at the top level, listed as the second entry in our internal list_D. Finally, a pipeline agg with the path down to B__BucketMetrics reduction would throw a class cast exception due to bad subpathing.  This test ensures_it is fixed.__Note: we have this test inside of the `avg_bucket` package so that we can get access to the package-private_`doReduce()` needed for testing this;public void testSameAggNames() throws IOException {_        Query query = new MatchAllDocsQuery()___        AvgAggregationBuilder avgBuilder = new AvgAggregationBuilder("foo").field(VALUE_FIELD)__        DateHistogramAggregationBuilder histo = new DateHistogramAggregationBuilder("histo")_            .dateHistogramInterval(DateHistogramInterval.YEAR)_            .field(DATE_FIELD)_            .subAggregation(new AvgAggregationBuilder("foo").field(VALUE_FIELD))___        AvgBucketPipelineAggregationBuilder avgBucketBuilder_            = new AvgBucketPipelineAggregationBuilder("the_avg_bucket", "histo>foo")___        try (Directory directory = newDirectory()) {_            try (RandomIndexWriter indexWriter = new RandomIndexWriter(random(), directory)) {_                Document document = new Document()__                for (String date : dataset) {_                    if (frequently()) {_                        indexWriter.commit()__                    }__                    document.add(new SortedNumericDocValuesField(DATE_FIELD, asLong(date)))__                    document.add(new SortedNumericDocValuesField(VALUE_FIELD, randomInt()))__                    indexWriter.addDocument(document)__                    document.clear()__                }_            }__            InternalAvg avgResult__            InternalDateHistogram histogramResult__            try (IndexReader indexReader = DirectoryReader.open(directory)) {_                IndexSearcher indexSearcher = newSearcher(indexReader, true, true)___                DateFieldMapper.Builder builder = new DateFieldMapper.Builder("histo")__                DateFieldMapper.DateFieldType fieldType = builder.fieldType()__                fieldType.setHasDocValues(true)__                fieldType.setName(DATE_FIELD)___                MappedFieldType valueFieldType = new NumberFieldMapper.NumberFieldType(NumberFieldMapper.NumberType.LONG)__                valueFieldType.setName(VALUE_FIELD)__                valueFieldType.setHasDocValues(true)___                avgResult = searchAndReduce(indexSearcher, query, avgBuilder, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__                histogramResult = searchAndReduce(indexSearcher, query, histo, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__            }__            _            PipelineAggregator avgBucketAgg = avgBucketBuilder.createInternal(Collections.emptyMap())__            List<Aggregation> reducedAggs = new ArrayList<>(2)___            _            reducedAggs.add(histogramResult)__            reducedAggs.add(avgResult)__            Aggregations aggregations = new Aggregations(reducedAggs)__            InternalAggregation pipelineResult = ((AvgBucketPipelineAggregator)avgBucketAgg).doReduce(aggregations, null)__            assertNotNull(pipelineResult)__        }_    };test,for,issue,30608,under,the,following,circumstances,a,multi,bucket,agg,in,the,first,entry,of,our,internal,list,b,regular,agg,as,the,immediate,child,of,the,multi,bucket,in,a,c,regular,agg,with,the,same,name,as,b,at,the,top,level,listed,as,the,second,entry,in,our,internal,list,d,finally,a,pipeline,agg,with,the,path,down,to,b,bucket,metrics,reduction,would,throw,a,class,cast,exception,due,to,bad,subpathing,this,test,ensures,it,is,fixed,note,we,have,this,test,inside,of,the,package,so,that,we,can,get,access,to,the,package,private,do,reduce,needed,for,testing,this;public,void,test,same,agg,names,throws,ioexception,query,query,new,match,all,docs,query,avg,aggregation,builder,avg,builder,new,avg,aggregation,builder,foo,field,date,histogram,aggregation,builder,histo,new,date,histogram,aggregation,builder,histo,date,histogram,interval,date,histogram,interval,year,field,sub,aggregation,new,avg,aggregation,builder,foo,field,avg,bucket,pipeline,aggregation,builder,avg,bucket,builder,new,avg,bucket,pipeline,aggregation,builder,histo,foo,try,directory,directory,new,directory,try,random,index,writer,index,writer,new,random,index,writer,random,directory,document,document,new,document,for,string,date,dataset,if,frequently,index,writer,commit,document,add,new,sorted,numeric,doc,values,field,as,long,date,document,add,new,sorted,numeric,doc,values,field,random,int,index,writer,add,document,document,document,clear,internal,avg,avg,result,internal,date,histogram,histogram,result,try,index,reader,index,reader,directory,reader,open,directory,index,searcher,index,searcher,new,searcher,index,reader,true,true,date,field,mapper,builder,builder,new,date,field,mapper,builder,histo,date,field,mapper,date,field,type,field,type,builder,field,type,field,type,set,has,doc,values,true,field,type,set,name,mapped,field,type,value,field,type,new,number,field,mapper,number,field,type,number,field,mapper,number,type,long,value,field,type,set,name,value,field,type,set,has,doc,values,true,avg,result,search,and,reduce,index,searcher,query,avg,builder,10000,null,new,mapped,field,type,field,type,value,field,type,histogram,result,search,and,reduce,index,searcher,query,histo,10000,null,new,mapped,field,type,field,type,value,field,type,pipeline,aggregator,avg,bucket,agg,avg,bucket,builder,create,internal,collections,empty,map,list,aggregation,reduced,aggs,new,array,list,2,reduced,aggs,add,histogram,result,reduced,aggs,add,avg,result,aggregations,aggregations,new,aggregations,reduced,aggs,internal,aggregation,pipeline,result,avg,bucket,pipeline,aggregator,avg,bucket,agg,do,reduce,aggregations,null,assert,not,null,pipeline,result
AvgBucketAggregatorTests -> public void testSameAggNames() throws IOException;1548236405;Test for issue #30608.  Under the following circumstances:__A. Multi-bucket agg in the first entry of our internal list_B. Regular agg as the immediate child of the multi-bucket in A_C. Regular agg with the same name as B at the top level, listed as the second entry in our internal list_D. Finally, a pipeline agg with the path down to B__BucketMetrics reduction would throw a class cast exception due to bad subpathing.  This test ensures_it is fixed.__Note: we have this test inside of the `avg_bucket` package so that we can get access to the package-private_`doReduce()` needed for testing this;public void testSameAggNames() throws IOException {_        Query query = new MatchAllDocsQuery()___        AvgAggregationBuilder avgBuilder = new AvgAggregationBuilder("foo").field(VALUE_FIELD)__        DateHistogramAggregationBuilder histo = new DateHistogramAggregationBuilder("histo")_            .dateHistogramInterval(DateHistogramInterval.YEAR)_            .field(DATE_FIELD)_            .subAggregation(new AvgAggregationBuilder("foo").field(VALUE_FIELD))___        AvgBucketPipelineAggregationBuilder avgBucketBuilder_            = new AvgBucketPipelineAggregationBuilder("the_avg_bucket", "histo>foo")___        try (Directory directory = newDirectory()) {_            try (RandomIndexWriter indexWriter = new RandomIndexWriter(random(), directory)) {_                Document document = new Document()__                for (String date : dataset) {_                    if (frequently()) {_                        indexWriter.commit()__                    }__                    document.add(new SortedNumericDocValuesField(DATE_FIELD, asLong(date)))__                    document.add(new SortedNumericDocValuesField(VALUE_FIELD, randomInt()))__                    indexWriter.addDocument(document)__                    document.clear()__                }_            }__            InternalAvg avgResult__            InternalDateHistogram histogramResult__            try (IndexReader indexReader = DirectoryReader.open(directory)) {_                IndexSearcher indexSearcher = newSearcher(indexReader, true, true)___                DateFieldMapper.Builder builder = new DateFieldMapper.Builder("histo")__                DateFieldMapper.DateFieldType fieldType = builder.fieldType()__                fieldType.setHasDocValues(true)__                fieldType.setName(DATE_FIELD)___                MappedFieldType valueFieldType = new NumberFieldMapper.NumberFieldType(NumberFieldMapper.NumberType.LONG)__                valueFieldType.setName(VALUE_FIELD)__                valueFieldType.setHasDocValues(true)___                avgResult = searchAndReduce(indexSearcher, query, avgBuilder, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__                histogramResult = searchAndReduce(indexSearcher, query, histo, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__            }__            _            PipelineAggregator avgBucketAgg = avgBucketBuilder.createInternal(Collections.emptyMap())__            List<Aggregation> reducedAggs = new ArrayList<>(2)___            _            reducedAggs.add(histogramResult)__            reducedAggs.add(avgResult)__            Aggregations aggregations = new Aggregations(reducedAggs)__            InternalAggregation pipelineResult = ((AvgBucketPipelineAggregator)avgBucketAgg).doReduce(aggregations, null)__            assertNotNull(pipelineResult)__        }_    };test,for,issue,30608,under,the,following,circumstances,a,multi,bucket,agg,in,the,first,entry,of,our,internal,list,b,regular,agg,as,the,immediate,child,of,the,multi,bucket,in,a,c,regular,agg,with,the,same,name,as,b,at,the,top,level,listed,as,the,second,entry,in,our,internal,list,d,finally,a,pipeline,agg,with,the,path,down,to,b,bucket,metrics,reduction,would,throw,a,class,cast,exception,due,to,bad,subpathing,this,test,ensures,it,is,fixed,note,we,have,this,test,inside,of,the,package,so,that,we,can,get,access,to,the,package,private,do,reduce,needed,for,testing,this;public,void,test,same,agg,names,throws,ioexception,query,query,new,match,all,docs,query,avg,aggregation,builder,avg,builder,new,avg,aggregation,builder,foo,field,date,histogram,aggregation,builder,histo,new,date,histogram,aggregation,builder,histo,date,histogram,interval,date,histogram,interval,year,field,sub,aggregation,new,avg,aggregation,builder,foo,field,avg,bucket,pipeline,aggregation,builder,avg,bucket,builder,new,avg,bucket,pipeline,aggregation,builder,histo,foo,try,directory,directory,new,directory,try,random,index,writer,index,writer,new,random,index,writer,random,directory,document,document,new,document,for,string,date,dataset,if,frequently,index,writer,commit,document,add,new,sorted,numeric,doc,values,field,as,long,date,document,add,new,sorted,numeric,doc,values,field,random,int,index,writer,add,document,document,document,clear,internal,avg,avg,result,internal,date,histogram,histogram,result,try,index,reader,index,reader,directory,reader,open,directory,index,searcher,index,searcher,new,searcher,index,reader,true,true,date,field,mapper,builder,builder,new,date,field,mapper,builder,histo,date,field,mapper,date,field,type,field,type,builder,field,type,field,type,set,has,doc,values,true,field,type,set,name,mapped,field,type,value,field,type,new,number,field,mapper,number,field,type,number,field,mapper,number,type,long,value,field,type,set,name,value,field,type,set,has,doc,values,true,avg,result,search,and,reduce,index,searcher,query,avg,builder,10000,null,new,mapped,field,type,field,type,value,field,type,histogram,result,search,and,reduce,index,searcher,query,histo,10000,null,new,mapped,field,type,field,type,value,field,type,pipeline,aggregator,avg,bucket,agg,avg,bucket,builder,create,internal,collections,empty,map,list,aggregation,reduced,aggs,new,array,list,2,reduced,aggs,add,histogram,result,reduced,aggs,add,avg,result,aggregations,aggregations,new,aggregations,reduced,aggs,internal,aggregation,pipeline,result,avg,bucket,pipeline,aggregator,avg,bucket,agg,do,reduce,aggregations,null,assert,not,null,pipeline,result
AvgBucketAggregatorTests -> public void testSameAggNames() throws IOException;1548921340;Test for issue #30608.  Under the following circumstances:__A. Multi-bucket agg in the first entry of our internal list_B. Regular agg as the immediate child of the multi-bucket in A_C. Regular agg with the same name as B at the top level, listed as the second entry in our internal list_D. Finally, a pipeline agg with the path down to B__BucketMetrics reduction would throw a class cast exception due to bad subpathing.  This test ensures_it is fixed.__Note: we have this test inside of the `avg_bucket` package so that we can get access to the package-private_`doReduce()` needed for testing this;public void testSameAggNames() throws IOException {_        Query query = new MatchAllDocsQuery()___        AvgAggregationBuilder avgBuilder = new AvgAggregationBuilder("foo").field(VALUE_FIELD)__        DateHistogramAggregationBuilder histo = new DateHistogramAggregationBuilder("histo")_            .dateHistogramInterval(DateHistogramInterval.YEAR)_            .field(DATE_FIELD)_            .subAggregation(new AvgAggregationBuilder("foo").field(VALUE_FIELD))___        AvgBucketPipelineAggregationBuilder avgBucketBuilder_            = new AvgBucketPipelineAggregationBuilder("the_avg_bucket", "histo>foo")___        try (Directory directory = newDirectory()) {_            try (RandomIndexWriter indexWriter = new RandomIndexWriter(random(), directory)) {_                Document document = new Document()__                for (String date : dataset) {_                    if (frequently()) {_                        indexWriter.commit()__                    }__                    document.add(new SortedNumericDocValuesField(DATE_FIELD, asLong(date)))__                    document.add(new SortedNumericDocValuesField(VALUE_FIELD, randomInt()))__                    indexWriter.addDocument(document)__                    document.clear()__                }_            }__            InternalAvg avgResult__            InternalDateHistogram histogramResult__            try (IndexReader indexReader = DirectoryReader.open(directory)) {_                IndexSearcher indexSearcher = newSearcher(indexReader, true, true)___                DateFieldMapper.Builder builder = new DateFieldMapper.Builder("histo")__                DateFieldMapper.DateFieldType fieldType = builder.fieldType()__                fieldType.setHasDocValues(true)__                fieldType.setName(DATE_FIELD)___                MappedFieldType valueFieldType = new NumberFieldMapper.NumberFieldType(NumberFieldMapper.NumberType.LONG)__                valueFieldType.setName(VALUE_FIELD)__                valueFieldType.setHasDocValues(true)___                avgResult = searchAndReduce(indexSearcher, query, avgBuilder, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__                histogramResult = searchAndReduce(indexSearcher, query, histo, 10000, null,_                    new MappedFieldType[]{fieldType, valueFieldType})__            }__            _            PipelineAggregator avgBucketAgg = avgBucketBuilder.createInternal(Collections.emptyMap())__            List<Aggregation> reducedAggs = new ArrayList<>(2)___            _            reducedAggs.add(histogramResult)__            reducedAggs.add(avgResult)__            Aggregations aggregations = new Aggregations(reducedAggs)__            InternalAggregation pipelineResult = ((AvgBucketPipelineAggregator)avgBucketAgg).doReduce(aggregations, null)__            assertNotNull(pipelineResult)__        }_    };test,for,issue,30608,under,the,following,circumstances,a,multi,bucket,agg,in,the,first,entry,of,our,internal,list,b,regular,agg,as,the,immediate,child,of,the,multi,bucket,in,a,c,regular,agg,with,the,same,name,as,b,at,the,top,level,listed,as,the,second,entry,in,our,internal,list,d,finally,a,pipeline,agg,with,the,path,down,to,b,bucket,metrics,reduction,would,throw,a,class,cast,exception,due,to,bad,subpathing,this,test,ensures,it,is,fixed,note,we,have,this,test,inside,of,the,package,so,that,we,can,get,access,to,the,package,private,do,reduce,needed,for,testing,this;public,void,test,same,agg,names,throws,ioexception,query,query,new,match,all,docs,query,avg,aggregation,builder,avg,builder,new,avg,aggregation,builder,foo,field,date,histogram,aggregation,builder,histo,new,date,histogram,aggregation,builder,histo,date,histogram,interval,date,histogram,interval,year,field,sub,aggregation,new,avg,aggregation,builder,foo,field,avg,bucket,pipeline,aggregation,builder,avg,bucket,builder,new,avg,bucket,pipeline,aggregation,builder,histo,foo,try,directory,directory,new,directory,try,random,index,writer,index,writer,new,random,index,writer,random,directory,document,document,new,document,for,string,date,dataset,if,frequently,index,writer,commit,document,add,new,sorted,numeric,doc,values,field,as,long,date,document,add,new,sorted,numeric,doc,values,field,random,int,index,writer,add,document,document,document,clear,internal,avg,avg,result,internal,date,histogram,histogram,result,try,index,reader,index,reader,directory,reader,open,directory,index,searcher,index,searcher,new,searcher,index,reader,true,true,date,field,mapper,builder,builder,new,date,field,mapper,builder,histo,date,field,mapper,date,field,type,field,type,builder,field,type,field,type,set,has,doc,values,true,field,type,set,name,mapped,field,type,value,field,type,new,number,field,mapper,number,field,type,number,field,mapper,number,type,long,value,field,type,set,name,value,field,type,set,has,doc,values,true,avg,result,search,and,reduce,index,searcher,query,avg,builder,10000,null,new,mapped,field,type,field,type,value,field,type,histogram,result,search,and,reduce,index,searcher,query,histo,10000,null,new,mapped,field,type,field,type,value,field,type,pipeline,aggregator,avg,bucket,agg,avg,bucket,builder,create,internal,collections,empty,map,list,aggregation,reduced,aggs,new,array,list,2,reduced,aggs,add,histogram,result,reduced,aggs,add,avg,result,aggregations,aggregations,new,aggregations,reduced,aggs,internal,aggregation,pipeline,result,avg,bucket,pipeline,aggregator,avg,bucket,agg,do,reduce,aggregations,null,assert,not,null,pipeline,result
