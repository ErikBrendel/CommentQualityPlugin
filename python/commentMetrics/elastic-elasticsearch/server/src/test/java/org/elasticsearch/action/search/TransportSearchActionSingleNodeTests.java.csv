commented;modifiers;parameterAmount;loc;comment;code
false;public;0;34;;public void testLocalClusterAlias() {     long nowInMillis = randomLongBetween(0, Long.MAX_VALUE).     IndexRequest indexRequest = new IndexRequest("test").     indexRequest.id("1").     indexRequest.source("field", "value").     indexRequest.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL).     IndexResponse indexResponse = client().index(indexRequest).actionGet().     assertEquals(RestStatus.CREATED, indexResponse.status()).     {         SearchRequest searchRequest = SearchRequest.crossClusterSearch(new SearchRequest(), Strings.EMPTY_ARRAY, "local", nowInMillis, randomBoolean()).         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(1, searchResponse.getHits().getTotalHits().value).         SearchHit[] hits = searchResponse.getHits().getHits().         assertEquals(1, hits.length).         SearchHit hit = hits[0].         assertEquals("local", hit.getClusterAlias()).         assertEquals("test", hit.getIndex()).         assertEquals("1", hit.getId()).     }     {         SearchRequest searchRequest = SearchRequest.crossClusterSearch(new SearchRequest(), Strings.EMPTY_ARRAY, "", nowInMillis, randomBoolean()).         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(1, searchResponse.getHits().getTotalHits().value).         SearchHit[] hits = searchResponse.getHits().getHits().         assertEquals(1, hits.length).         SearchHit hit = hits[0].         assertEquals("", hit.getClusterAlias()).         assertEquals("test", hit.getIndex()).         assertEquals("1", hit.getId()).     } }
false;public;0;56;;public void testAbsoluteStartMillis() {     {         IndexRequest indexRequest = new IndexRequest("test-1970.01.01").         indexRequest.id("1").         indexRequest.source("date", "1970-01-01").         indexRequest.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL).         IndexResponse indexResponse = client().index(indexRequest).actionGet().         assertEquals(RestStatus.CREATED, indexResponse.status()).     }     {         IndexRequest indexRequest = new IndexRequest("test-1982.01.01").         indexRequest.id("1").         indexRequest.source("date", "1982-01-01").         indexRequest.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL).         IndexResponse indexResponse = client().index(indexRequest).actionGet().         assertEquals(RestStatus.CREATED, indexResponse.status()).     }     {         SearchRequest searchRequest = new SearchRequest().         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(2, searchResponse.getHits().getTotalHits().value).     }     {         SearchRequest searchRequest = new SearchRequest("<test-{now/d}>").         searchRequest.indicesOptions(IndicesOptions.fromOptions(true, true, true, true)).         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(0, searchResponse.getTotalShards()).     }     {         SearchRequest searchRequest = SearchRequest.crossClusterSearch(new SearchRequest(), Strings.EMPTY_ARRAY, "", 0, randomBoolean()).         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(2, searchResponse.getHits().getTotalHits().value).     }     {         SearchRequest searchRequest = SearchRequest.crossClusterSearch(new SearchRequest(), Strings.EMPTY_ARRAY, "", 0, randomBoolean()).         searchRequest.indices("<test-{now/d}>").         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(1, searchResponse.getHits().getTotalHits().value).         assertEquals("test-1970.01.01", searchResponse.getHits().getHits()[0].getIndex()).     }     {         SearchRequest searchRequest = SearchRequest.crossClusterSearch(new SearchRequest(), Strings.EMPTY_ARRAY, "", 0, randomBoolean()).         SearchSourceBuilder sourceBuilder = new SearchSourceBuilder().         RangeQueryBuilder rangeQuery = new RangeQueryBuilder("date").         rangeQuery.gte("1970-01-01").         rangeQuery.lt("1982-01-01").         sourceBuilder.query(rangeQuery).         searchRequest.source(sourceBuilder).         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(1, searchResponse.getHits().getTotalHits().value).         assertEquals("test-1970.01.01", searchResponse.getHits().getHits()[0].getIndex()).     } }
false;public;0;46;;public void testFinalReduce() {     long nowInMillis = randomLongBetween(0, Long.MAX_VALUE).     {         IndexRequest indexRequest = new IndexRequest("test").         indexRequest.id("1").         indexRequest.source("price", 10).         IndexResponse indexResponse = client().index(indexRequest).actionGet().         assertEquals(RestStatus.CREATED, indexResponse.status()).     }     {         IndexRequest indexRequest = new IndexRequest("test").         indexRequest.id("2").         indexRequest.source("price", 100).         IndexResponse indexResponse = client().index(indexRequest).actionGet().         assertEquals(RestStatus.CREATED, indexResponse.status()).     }     client().admin().indices().prepareRefresh("test").get().     SearchRequest originalRequest = new SearchRequest().     SearchSourceBuilder source = new SearchSourceBuilder().     source.size(0).     originalRequest.source(source).     TermsAggregationBuilder terms = new TermsAggregationBuilder("terms", ValueType.NUMERIC).     terms.field("price").     terms.size(1).     source.aggregation(terms).     {         SearchRequest searchRequest = randomBoolean() ? originalRequest : SearchRequest.crossClusterSearch(originalRequest, Strings.EMPTY_ARRAY, "remote", nowInMillis, true).         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(2, searchResponse.getHits().getTotalHits().value).         Aggregations aggregations = searchResponse.getAggregations().         LongTerms longTerms = aggregations.get("terms").         assertEquals(1, longTerms.getBuckets().size()).     }     {         SearchRequest searchRequest = SearchRequest.crossClusterSearch(originalRequest, Strings.EMPTY_ARRAY, "remote", nowInMillis, false).         SearchResponse searchResponse = client().search(searchRequest).actionGet().         assertEquals(2, searchResponse.getHits().getTotalHits().value).         Aggregations aggregations = searchResponse.getAggregations().         LongTerms longTerms = aggregations.get("terms").         assertEquals(2, longTerms.getBuckets().size()).     } }
