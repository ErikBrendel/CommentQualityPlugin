commented;modifiers;parameterAmount;loc;comment;code
false;protected;1;6;;@Override protected void doWriteTo(StreamOutput out) throws IOException {     out.writeNamedWriteable(format).     out.writeDouble(sum).     out.writeDouble(weight). }
false;public;0;4;;@Override public double value() {     return getValue(). }
false;public;0;4;;@Override public double getValue() {     return sum / weight. }
false;;0;3;;double getSum() {     return sum. }
false;;0;3;;double getWeight() {     return weight. }
false;;0;3;;DocValueFormat getFormatter() {     return format. }
false;public;0;4;;@Override public String getWriteableName() {     return WeightedAvgAggregationBuilder.NAME. }
false;public;2;33;;@Override public InternalWeightedAvg doReduce(List<InternalAggregation> aggregations, ReduceContext reduceContext) {     double weight = 0.     double sum = 0.     double sumCompensation = 0.     double weightCompensation = 0.     // accurate than naive summation.     for (InternalAggregation aggregation : aggregations) {         InternalWeightedAvg avg = (InternalWeightedAvg) aggregation.         // Inf/NaN.  This keeps the behavior bwc from before kahan summing         if (Double.isFinite(avg.weight) == false) {             weight += avg.weight.         } else if (Double.isFinite(weight)) {             double corrected = avg.weight - weightCompensation.             double newWeight = weight + corrected.             weightCompensation = (newWeight - weight) - corrected.             weight = newWeight.         }         // Inf/NaN.  This keeps the behavior bwc from before kahan summing         if (Double.isFinite(avg.sum) == false) {             sum += avg.sum.         } else if (Double.isFinite(sum)) {             double corrected = avg.sum - sumCompensation.             double newSum = sum + corrected.             sumCompensation = (newSum - sum) - corrected.             sum = newSum.         }     }     return new InternalWeightedAvg(getName(), sum, weight, format, pipelineAggregators(), getMetaData()). }
false;public;2;8;;@Override public XContentBuilder doXContentBody(XContentBuilder builder, Params params) throws IOException {     builder.field(CommonFields.VALUE.getPreferredName(), weight != 0 ? getValue() : null).     if (weight != 0 && format != DocValueFormat.RAW) {         builder.field(CommonFields.VALUE_AS_STRING.getPreferredName(), format.format(getValue())).     }     return builder. }
false;protected;0;4;;@Override protected int doHashCode() {     return Objects.hash(sum, weight, format.getWriteableName()). }
false;protected;1;7;;@Override protected boolean doEquals(Object obj) {     InternalWeightedAvg other = (InternalWeightedAvg) obj.     return Objects.equals(sum, other.sum) && Objects.equals(weight, other.weight) && Objects.equals(format.getWriteableName(), other.format.getWriteableName()). }
