commented;modifiers;parameterAmount;loc;comment;code
false;protected;0;4;;@Override protected TomcatReactiveWebServerFactory getFactory() {     return new TomcatReactiveWebServerFactory(0). }
false;public;0;13;;@Test public void tomcatCustomizers() {     TomcatReactiveWebServerFactory factory = getFactory().     TomcatContextCustomizer[] listeners = new TomcatContextCustomizer[4].     Arrays.setAll(listeners, (i) -> mock(TomcatContextCustomizer.class)).     factory.setTomcatContextCustomizers(Arrays.asList(listeners[0], listeners[1])).     factory.addContextCustomizers(listeners[2], listeners[3]).     this.webServer = factory.getWebServer(mock(HttpHandler.class)).     InOrder ordered = inOrder((Object[]) listeners).     for (TomcatContextCustomizer listener : listeners) {         ordered.verify(listener).customize(any(Context.class)).     } }
false;public;0;10;;@Test public void contextIsAddedToHostBeforeCustomizersAreCalled() {     TomcatReactiveWebServerFactory factory = getFactory().     TomcatContextCustomizer customizer = mock(TomcatContextCustomizer.class).     factory.addContextCustomizers(customizer).     this.webServer = factory.getWebServer(mock(HttpHandler.class)).     ArgumentCaptor<Context> contextCaptor = ArgumentCaptor.forClass(Context.class).     verify(customizer).customize(contextCaptor.capture()).     assertThat(contextCaptor.getValue().getParent()).isNotNull(). }
false;public;0;6;;@Test public void defaultTomcatListeners() {     TomcatReactiveWebServerFactory factory = getFactory().     assertThat(factory.getContextLifecycleListeners()).hasSize(1).first().isInstanceOf(AprLifecycleListener.class). }
false;public;0;13;;@Test public void tomcatListeners() {     TomcatReactiveWebServerFactory factory = getFactory().     LifecycleListener[] listeners = new LifecycleListener[4].     Arrays.setAll(listeners, (i) -> mock(LifecycleListener.class)).     factory.setContextLifecycleListeners(Arrays.asList(listeners[0], listeners[1])).     factory.addContextLifecycleListeners(listeners[2], listeners[3]).     this.webServer = factory.getWebServer(mock(HttpHandler.class)).     InOrder ordered = inOrder((Object[]) listeners).     for (LifecycleListener listener : listeners) {         ordered.verify(listener).lifecycleEvent(any(LifecycleEvent.class)).     } }
false;public;0;7;;@Test public void setNullConnectorCustomizersShouldThrowException() {     TomcatReactiveWebServerFactory factory = getFactory().     assertThatIllegalArgumentException().isThrownBy(() -> factory.setTomcatConnectorCustomizers(null)).withMessageContaining("Customizers must not be null"). }
false;public;0;7;;@Test public void addNullAddConnectorCustomizersShouldThrowException() {     TomcatReactiveWebServerFactory factory = getFactory().     assertThatIllegalArgumentException().isThrownBy(() -> factory.addConnectorCustomizers((TomcatConnectorCustomizer[]) null)).withMessageContaining("Customizers must not be null"). }
false;public;0;14;;@Test public void tomcatConnectorCustomizersShouldBeInvoked() {     TomcatReactiveWebServerFactory factory = getFactory().     HttpHandler handler = mock(HttpHandler.class).     TomcatConnectorCustomizer[] listeners = new TomcatConnectorCustomizer[4].     Arrays.setAll(listeners, (i) -> mock(TomcatConnectorCustomizer.class)).     factory.setTomcatConnectorCustomizers(Arrays.asList(listeners[0], listeners[1])).     factory.addConnectorCustomizers(listeners[2], listeners[3]).     this.webServer = factory.getWebServer(handler).     InOrder ordered = inOrder((Object[]) listeners).     for (TomcatConnectorCustomizer listener : listeners) {         ordered.verify(listener).customize(any(Connector.class)).     } }
false;public;0;8;;@Test public void useForwardedHeaders() {     TomcatReactiveWebServerFactory factory = getFactory().     RemoteIpValve valve = new RemoteIpValve().     valve.setProtocolHeader("X-Forwarded-Proto").     factory.addEngineValves(valve).     assertForwardHeaderIsUsed(factory). }
false;public;0;11;;@Test public void referenceClearingIsDisabled() {     TomcatReactiveWebServerFactory factory = getFactory().     this.webServer = factory.getWebServer(mock(HttpHandler.class)).     this.webServer.start().     Tomcat tomcat = ((TomcatWebServer) this.webServer).getTomcat().     StandardContext context = (StandardContext) tomcat.getHost().findChildren()[0].     assertThat(context.getClearReferencesObjectStreamClassCaches()).isFalse().     assertThat(context.getClearReferencesRmiTargets()).isFalse().     assertThat(context.getClearReferencesThreadLocals()).isFalse(). }
