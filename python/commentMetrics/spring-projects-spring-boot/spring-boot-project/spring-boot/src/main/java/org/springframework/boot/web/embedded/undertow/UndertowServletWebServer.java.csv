commented;modifiers;parameterAmount;loc;comment;code
false;public;0;38;;@Override public void start() throws WebServerException {     synchronized (this.monitor) {         if (this.started) {             return.         }         try {             if (!this.autoStart) {                 return.             }             if (this.undertow == null) {                 this.undertow = createUndertowServer().             }             this.undertow.start().             this.started = true.             UndertowServletWebServer.logger.info("Undertow started on port(s) " + getPortsDescription() + " with context path '" + this.contextPath + "'").         } catch (Exception ex) {             try {                 if (findBindException(ex) != null) {                     List<Port> failedPorts = getConfiguredPorts().                     List<Port> actualPorts = getActualPorts().                     failedPorts.removeAll(actualPorts).                     if (failedPorts.size() == 1) {                         throw new PortInUseException(failedPorts.iterator().next().getNumber()).                     }                 }                 throw new WebServerException("Unable to start embedded Undertow", ex).             } finally {                 stopSilently().             }         }     } }
false;public;0;5;;public DeploymentManager getDeploymentManager() {     synchronized (this.monitor) {         return this.manager.     } }
false;private;0;10;;private void stopSilently() {     try {         if (this.undertow != null) {             this.undertow.stop().         }     } catch (Exception ex) {     // Ignore     } }
false;private;1;10;;private BindException findBindException(Exception ex) {     Throwable candidate = ex.     while (candidate != null) {         if (candidate instanceof BindException) {             return (BindException) candidate.         }         candidate = candidate.getCause().     }     return null. }
false;private;0;12;;private Undertow createUndertowServer() throws ServletException {     HttpHandler httpHandler = this.manager.start().     httpHandler = getContextHandler(httpHandler).     if (this.useForwardHeaders) {         httpHandler = Handlers.proxyPeerAddress(httpHandler).     }     if (StringUtils.hasText(this.serverHeader)) {         httpHandler = Handlers.header(httpHandler, "Server", this.serverHeader).     }     this.builder.setHandler(httpHandler).     return this.builder.build(). }
false;private;1;8;;private HttpHandler getContextHandler(HttpHandler httpHandler) {     HttpHandler contextHandler = UndertowCompressionConfigurer.configureCompression(this.compression, httpHandler).     if (StringUtils.isEmpty(this.contextPath)) {         return contextHandler.     }     return Handlers.path().addPrefixPath(this.contextPath, contextHandler). }
false;private;0;7;;private String getPortsDescription() {     List<Port> ports = getActualPorts().     if (!ports.isEmpty()) {         return StringUtils.collectionToDelimitedString(ports, " ").     }     return "unknown". }
false;private;0;17;;private List<Port> getActualPorts() {     List<Port> ports = new ArrayList<>().     try {         if (!this.autoStart) {             ports.add(new Port(-1, "unknown")).         } else {             for (BoundChannel channel : extractChannels()) {                 ports.add(getPortFromChannel(channel)).             }         }     } catch (Exception ex) {     // Continue     }     return ports. }
false;private;0;7;;@SuppressWarnings("unchecked") private List<BoundChannel> extractChannels() {     Field channelsField = ReflectionUtils.findField(Undertow.class, "channels").     ReflectionUtils.makeAccessible(channelsField).     return (List<BoundChannel>) ReflectionUtils.getField(channelsField, this.undertow). }
false;private;1;9;;private Port getPortFromChannel(BoundChannel channel) {     SocketAddress socketAddress = channel.getLocalAddress().     if (socketAddress instanceof InetSocketAddress) {         String protocol = (ReflectionUtils.findField(channel.getClass(), "ssl") != null) ? "https" : "http".         return new Port(((InetSocketAddress) socketAddress).getPort(), protocol).     }     return null. }
false;private;0;15;;private List<Port> getConfiguredPorts() {     List<Port> ports = new ArrayList<>().     for (Object listener : extractListeners()) {         try {             Port port = getPortFromListener(listener).             if (port.getNumber() != 0) {                 ports.add(port).             }         } catch (Exception ex) {         // Continue         }     }     return ports. }
false;private;0;6;;@SuppressWarnings("unchecked") private List<Object> extractListeners() {     Field listenersField = ReflectionUtils.findField(Undertow.class, "listeners").     ReflectionUtils.makeAccessible(listenersField).     return (List<Object>) ReflectionUtils.getField(listenersField, this.undertow). }
false;private;1;9;;private Port getPortFromListener(Object listener) {     Field typeField = ReflectionUtils.findField(listener.getClass(), "type").     ReflectionUtils.makeAccessible(typeField).     String protocol = ReflectionUtils.getField(typeField, listener).toString().     Field portField = ReflectionUtils.findField(listener.getClass(), "port").     ReflectionUtils.makeAccessible(portField).     int port = (Integer) ReflectionUtils.getField(portField, listener).     return new Port(port, protocol). }
false;public;0;17;;@Override public void stop() throws WebServerException {     synchronized (this.monitor) {         if (!this.started) {             return.         }         this.started = false.         try {             this.manager.stop().             this.manager.undeploy().             this.undertow.stop().         } catch (Exception ex) {             throw new WebServerException("Unable to stop undertow", ex).         }     } }
false;public;0;8;;@Override public int getPort() {     List<Port> ports = getActualPorts().     if (ports.isEmpty()) {         return 0.     }     return ports.get(0).getNumber(). }
false;public;0;3;;public int getNumber() {     return this.number. }
false;public;1;17;;@Override public boolean equals(Object obj) {     if (this == obj) {         return true.     }     if (obj == null) {         return false.     }     if (getClass() != obj.getClass()) {         return false.     }     Port other = (Port) obj.     if (this.number != other.number) {         return false.     }     return true. }
false;public;0;4;;@Override public int hashCode() {     return this.number. }
false;public;0;4;;@Override public String toString() {     return this.number + " (" + this.protocol + ")". }
