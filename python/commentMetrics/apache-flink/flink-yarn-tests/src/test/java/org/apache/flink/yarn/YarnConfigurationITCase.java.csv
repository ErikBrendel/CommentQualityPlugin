# id;timestamp;commentText;codeText;commentWords;codeWords
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1520032158;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, (1L << 20))__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, (4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final Flip6YarnClusterDescriptor clusterDescriptor = new Flip6YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = new File("target/programs/WindowJoin.jar")___		assertThat(streamingWordCountFile.exists(), is(true))___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					if (taskManagerInfos.isEmpty()) {_						Thread.sleep(100L)__					} else {_						break__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.terminateCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,long,task,manager,options,1l,20,configuration,set,long,task,manager,options,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,flip6yarn,cluster,descriptor,cluster,descriptor,new,flip6yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,new,file,target,programs,window,join,jar,assert,that,streaming,word,count,file,exists,is,true,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,task,manager,infos,is,empty,thread,sleep,100l,else,break,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,terminate,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1521739913;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration.clone())___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, (1L << 20))__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, (4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final Flip6YarnClusterDescriptor clusterDescriptor = new Flip6YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = new File("target/programs/WindowJoin.jar")___		assertThat(streamingWordCountFile.exists(), is(true))___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					if (taskManagerInfos.isEmpty()) {_						Thread.sleep(100L)__					} else {_						break__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.terminateCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,clone,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,long,task,manager,options,1l,20,configuration,set,long,task,manager,options,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,flip6yarn,cluster,descriptor,cluster,descriptor,new,flip6yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,new,file,target,programs,window,join,jar,assert,that,streaming,word,count,file,exists,is,true,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,task,manager,infos,is,empty,thread,sleep,100l,else,break,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,terminate,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1521739913;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, (1L << 20))__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, (4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final Flip6YarnClusterDescriptor clusterDescriptor = new Flip6YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = new File("target/programs/WindowJoin.jar")___		assertThat(streamingWordCountFile.exists(), is(true))___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					if (taskManagerInfos.isEmpty()) {_						Thread.sleep(100L)__					} else {_						break__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.terminateCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,long,task,manager,options,1l,20,configuration,set,long,task,manager,options,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,flip6yarn,cluster,descriptor,cluster,descriptor,new,flip6yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,new,file,target,programs,window,join,jar,assert,that,streaming,word,count,file,exists,is,true,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,task,manager,infos,is,empty,thread,sleep,100l,else,break,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,terminate,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1522681180;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, (1L << 20))__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, (4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final YarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = new File("target/programs/WindowJoin.jar")___		assertThat(streamingWordCountFile.exists(), is(true))___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					if (taskManagerInfos.isEmpty()) {_						Thread.sleep(100L)__					} else {_						break__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.terminateCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,long,task,manager,options,1l,20,configuration,set,long,task,manager,options,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,yarn,cluster,descriptor,cluster,descriptor,new,yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,new,file,target,programs,window,join,jar,assert,that,streaming,word,count,file,exists,is,true,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,task,manager,infos,is,empty,thread,sleep,100l,else,break,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,terminate,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1523554815;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, (1L << 20))__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, (4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final YarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = getTestJarPath("WindowJoin.jar")___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					if (taskManagerInfos.isEmpty()) {_						Thread.sleep(100L)__					} else {_						break__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.terminateCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,long,task,manager,options,1l,20,configuration,set,long,task,manager,options,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,yarn,cluster,descriptor,cluster,descriptor,new,yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,get,test,jar,path,window,join,jar,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,task,manager,infos,is,empty,thread,sleep,100l,else,break,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,terminate,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1525116069;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, (1L << 20))__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, (4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final YarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = getTestJarPath("WindowJoin.jar")___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					if (taskManagerInfos.isEmpty()) {_						Thread.sleep(100L)__					} else {_						break__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.killCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,long,task,manager,options,1l,20,configuration,set,long,task,manager,options,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,yarn,cluster,descriptor,cluster,descriptor,new,yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,get,test,jar,path,window,join,jar,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,task,manager,infos,is,empty,thread,sleep,100l,else,break,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,kill,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1527173115;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, (1L << 20))__		configuration.setLong(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, (4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final YarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = getTestJarPath("WindowJoin.jar")___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					_					if (hasTaskManagerConnectedAndReportedSlots(taskManagerInfos)) {_						break__					} else {_						Thread.sleep(100L)__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.killCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,long,task,manager,options,1l,20,configuration,set,long,task,manager,options,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,yarn,cluster,descriptor,cluster,descriptor,new,yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,get,test,jar,path,window,join,jar,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,has,task,manager,connected,and,reported,slots,task,manager,infos,break,else,thread,sleep,100l,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,kill,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1530798894;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setString(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, String.valueOf(1L << 20))__		configuration.setString(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, String.valueOf(4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final YarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = getTestJarPath("WindowJoin.jar")___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					_					if (hasTaskManagerConnectedAndReportedSlots(taskManagerInfos)) {_						break__					} else {_						Thread.sleep(100L)__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.killCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,string,task,manager,options,string,value,of,1l,20,configuration,set,string,task,manager,options,string,value,of,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,yarn,cluster,descriptor,cluster,descriptor,new,yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,get,test,jar,path,window,join,jar,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,has,task,manager,connected,and,reported,slots,task,manager,infos,break,else,thread,sleep,100l,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,1,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,kill,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1541154822;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setString(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, String.valueOf(1L << 20))__		configuration.setString(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, String.valueOf(4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final YarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))___		final File streamingWordCountFile = getTestJarPath("WindowJoin.jar")___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					_					if (hasTaskManagerConnectedAndReportedSlots(taskManagerInfos)) {_						break__					} else {_						Thread.sleep(100L)__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				_				_				_				assertThat(_					(double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize,_					is(closeTo(1.0, 0.15)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.killCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,string,task,manager,options,string,value,of,1l,20,configuration,set,string,task,manager,options,string,value,of,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,yarn,cluster,descriptor,cluster,descriptor,new,yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,final,file,streaming,word,count,file,get,test,jar,path,window,join,jar,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,has,task,manager,connected,and,reported,slots,task,manager,infos,break,else,thread,sleep,100l,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,15,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,kill,cluster,cluster,id,finally,cluster,descriptor,close
YarnConfigurationITCase -> @Test(timeout = 60000) 	public void testFlinkContainerMemory() throws Exception;1548773096;Tests that the Flink components are started with the correct_memory settings.;@Test(timeout = 60000)_	public void testFlinkContainerMemory() throws Exception {_		final YarnClient yarnClient = getYarnClient()__		final Configuration configuration = new Configuration(flinkConfiguration)___		final int masterMemory = 64__		final int taskManagerMemory = 128__		final int slotsPerTaskManager = 3___		_		configuration.setInteger(ResourceManagerOptions.CONTAINERIZED_HEAP_CUTOFF_MIN, 0)__		configuration.setString(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MIN, String.valueOf(1L << 20))__		configuration.setString(TaskManagerOptions.NETWORK_BUFFERS_MEMORY_MAX, String.valueOf(4L << 20))___		final YarnConfiguration yarnConfiguration = getYarnConfiguration()__		final YarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(_			configuration,_			yarnConfiguration,_			CliFrontend.getConfigurationDirectoryFromEnv(),_			yarnClient,_			true)___		clusterDescriptor.setLocalJarPath(new Path(flinkUberjar.getAbsolutePath()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkLibFolder.listFiles()))__		clusterDescriptor.addShipFiles(Arrays.asList(flinkShadedHadoopDir.listFiles()))___		final File streamingWordCountFile = getTestJarPath("WindowJoin.jar")___		final PackagedProgram packagedProgram = new PackagedProgram(streamingWordCountFile)__		final JobGraph jobGraph = PackagedProgramUtils.createJobGraph(packagedProgram, configuration, 1)___		try {_			final ClusterSpecification clusterSpecification = new ClusterSpecification.ClusterSpecificationBuilder()_				.setMasterMemoryMB(masterMemory)_				.setTaskManagerMemoryMB(taskManagerMemory)_				.setSlotsPerTaskManager(slotsPerTaskManager)_				.createClusterSpecification()___			final ClusterClient<ApplicationId> clusterClient = clusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true)___			final ApplicationId clusterId = clusterClient.getClusterId()___			final RestClient restClient = new RestClient(RestClientConfiguration.fromConfiguration(configuration), TestingUtils.defaultExecutor())___			try {_				final ApplicationReport applicationReport = yarnClient.getApplicationReport(clusterId)___				final ApplicationAttemptId currentApplicationAttemptId = applicationReport.getCurrentApplicationAttemptId()___				_				List<ContainerReport> containers = yarnClient.getContainers(currentApplicationAttemptId)___				while (containers.size() < 2) {_					_					Thread.sleep(50L)__					containers = yarnClient.getContainers(currentApplicationAttemptId)__				}__				for (ContainerReport container : containers) {_					if (container.getContainerId().getId() == 1) {_						_						assertThat(container.getAllocatedResource().getMemory(), is(masterMemory))__					} else {_						assertThat(container.getAllocatedResource().getMemory(), is(taskManagerMemory))__					}_				}__				final URI webURI = new URI(clusterClient.getWebInterfaceURL())___				CompletableFuture<TaskManagersInfo> taskManagersInfoCompletableFuture__				Collection<TaskManagerInfo> taskManagerInfos___				while (true) {_					taskManagersInfoCompletableFuture = restClient.sendRequest(_						webURI.getHost(),_						webURI.getPort(),_						TaskManagersHeaders.getInstance(),_						EmptyMessageParameters.getInstance(),_						EmptyRequestBody.getInstance())___					final TaskManagersInfo taskManagersInfo = taskManagersInfoCompletableFuture.get()___					taskManagerInfos = taskManagersInfo.getTaskManagerInfos()___					_					if (hasTaskManagerConnectedAndReportedSlots(taskManagerInfos)) {_						break__					} else {_						Thread.sleep(100L)__					}_				}__				_				final TaskManagerInfo taskManagerInfo = taskManagerInfos.iterator().next()___				assertThat(taskManagerInfo.getNumberSlots(), is(slotsPerTaskManager))___				final ContaineredTaskManagerParameters containeredTaskManagerParameters = ContaineredTaskManagerParameters.create(_					configuration,_					taskManagerMemory,_					slotsPerTaskManager)___				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() << 20L___				_				_				_				assertThat(_					(double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize,_					is(closeTo(1.0, 0.15)))__			} finally {_				restClient.shutdown(TIMEOUT)__				clusterClient.shutdown()__			}__			clusterDescriptor.killCluster(clusterId)___		} finally {_			clusterDescriptor.close()__		}_	};tests,that,the,flink,components,are,started,with,the,correct,memory,settings;test,timeout,60000,public,void,test,flink,container,memory,throws,exception,final,yarn,client,yarn,client,get,yarn,client,final,configuration,configuration,new,configuration,flink,configuration,final,int,master,memory,64,final,int,task,manager,memory,128,final,int,slots,per,task,manager,3,configuration,set,integer,resource,manager,options,0,configuration,set,string,task,manager,options,string,value,of,1l,20,configuration,set,string,task,manager,options,string,value,of,4l,20,final,yarn,configuration,yarn,configuration,get,yarn,configuration,final,yarn,cluster,descriptor,cluster,descriptor,new,yarn,cluster,descriptor,configuration,yarn,configuration,cli,frontend,get,configuration,directory,from,env,yarn,client,true,cluster,descriptor,set,local,jar,path,new,path,flink,uberjar,get,absolute,path,cluster,descriptor,add,ship,files,arrays,as,list,flink,lib,folder,list,files,cluster,descriptor,add,ship,files,arrays,as,list,flink,shaded,hadoop,dir,list,files,final,file,streaming,word,count,file,get,test,jar,path,window,join,jar,final,packaged,program,packaged,program,new,packaged,program,streaming,word,count,file,final,job,graph,job,graph,packaged,program,utils,create,job,graph,packaged,program,configuration,1,try,final,cluster,specification,cluster,specification,new,cluster,specification,cluster,specification,builder,set,master,memory,mb,master,memory,set,task,manager,memory,mb,task,manager,memory,set,slots,per,task,manager,slots,per,task,manager,create,cluster,specification,final,cluster,client,application,id,cluster,client,cluster,descriptor,deploy,job,cluster,cluster,specification,job,graph,true,final,application,id,cluster,id,cluster,client,get,cluster,id,final,rest,client,rest,client,new,rest,client,rest,client,configuration,from,configuration,configuration,testing,utils,default,executor,try,final,application,report,application,report,yarn,client,get,application,report,cluster,id,final,application,attempt,id,current,application,attempt,id,application,report,get,current,application,attempt,id,list,container,report,containers,yarn,client,get,containers,current,application,attempt,id,while,containers,size,2,thread,sleep,50l,containers,yarn,client,get,containers,current,application,attempt,id,for,container,report,container,containers,if,container,get,container,id,get,id,1,assert,that,container,get,allocated,resource,get,memory,is,master,memory,else,assert,that,container,get,allocated,resource,get,memory,is,task,manager,memory,final,uri,web,uri,new,uri,cluster,client,get,web,interface,url,completable,future,task,managers,info,task,managers,info,completable,future,collection,task,manager,info,task,manager,infos,while,true,task,managers,info,completable,future,rest,client,send,request,web,uri,get,host,web,uri,get,port,task,managers,headers,get,instance,empty,message,parameters,get,instance,empty,request,body,get,instance,final,task,managers,info,task,managers,info,task,managers,info,completable,future,get,task,manager,infos,task,managers,info,get,task,manager,infos,if,has,task,manager,connected,and,reported,slots,task,manager,infos,break,else,thread,sleep,100l,final,task,manager,info,task,manager,info,task,manager,infos,iterator,next,assert,that,task,manager,info,get,number,slots,is,slots,per,task,manager,final,containered,task,manager,parameters,containered,task,manager,parameters,containered,task,manager,parameters,create,configuration,task,manager,memory,slots,per,task,manager,final,long,expected,head,size,containered,task,manager,parameters,task,manager,heap,size,mb,20l,assert,that,double,task,manager,info,get,hardware,description,get,size,of,jvm,heap,double,expected,head,size,is,close,to,1,0,0,15,finally,rest,client,shutdown,timeout,cluster,client,shutdown,cluster,descriptor,kill,cluster,cluster,id,finally,cluster,descriptor,close
